var SPModelSchedule=function(){this.model="schedule"};SPModelSchedule.prototype.vacation=function(a,b,c,d,e){sp.api(this.model+"."+a,b,c,d,e)};SPModelSchedule.prototype.vacations=function(a,b,c,d,e){sp.api(this.model+"."+a,b,c,d,e)};
SPModelSchedule.prototype.schedulesByUser=function(a,b){"undefined"==typeof b&&(b=!1);if("undefined"!=typeof sp.staff.data.employees[a]){if(b){var c="undefined"==typeof sp.staff.data.employees[a].schedules?{}:sp.staff.data.employees[a].schedules,d={};$.each(sp.schedule.raw.schedules,function(a,b){"undefined"!=typeof c[b.id]&&("undefined"==typeof b.location&&(b.location={name:_("Schedules")}),"undefined"==typeof d[b.location.name]&&(d[b.location.name]={name:b.location.name,data:[]}),d[b.location.name].data.push(b))});
return d}return"undefined"==typeof sp.staff.data.employees[a].schedules?{}:sp.staff.data.employees[a].schedules}return{}};SPModelSchedule.prototype.allSchedules=function(a){if("undefined"==typeof a)return sp.schedule.data.schedules;spModel.schedule.get("schedules",{},function(a){sp.schedule.raw.schedules=a.data;sp.schedule.data.schedules=sp.map(a.data);return sp.schedule.data.schedules},function(){Log.log("implement");return{}})};var SPModelRequests=function(){this.model="requests"};
SPModelRequests.prototype.vacations=function(a,b,c,d,e){sp.api(this.model+"."+a,b,c,d,e)};var SPModelAdmin=function(){this.model="admin"};SPModelAdmin.prototype.vacations=function(a,b,c,d,e){sp.api(this.model+"."+a,b,c,d,e)};var SPModelMessaging=function(){this.model="messaging"};SPModelMessaging.prototype.wall=function(a,b,c,d,e){var f=this;sp.api(this.model+"."+a,b,c,function(a){"function"==typeof d&&("get"==b&&(a.data=f.prepareWallMessages(a.data)),d.call(this,a))},e)};
SPModelMessaging.prototype.prepareWallMessages=function(a){var b=[];$.each(a,function(){var a=[];"undefined"!=typeof this.comments&&$.each(this.comments,function(){a.push({id:this.id,avatar:sp.getAvatar(this.user.id),userName:this.user.name,userId:this.user.id,time:$.timeago(new Date(1E3*this.date)),comment:this.comment_formatted,full:!0,owner:3>=parseInt(sp.staff.admin.info.group)||this.user.id==sp.staff.admin.info.id?1:0})});b.push({id:this.id,avatar:sp.getAvatar(this.user.id),userName:this.user.name,
userId:this.user.id,time:$.timeago(new Date(1E3*this.date)),sticky:parseInt(this.sticky),title:this.title_formatted,post:this.post_formatted,comments:a,owner:3>=parseInt(sp.staff.admin.info.group)||this.user.id==sp.staff.admin.info.id?1:0})});return b};var SPModelTimeClock=function(){this.model="timeclock"};SPModelTimeClock.prototype.dtc=function(a,b){spModel.timeclock.del("timeclock",{id:a},function(a){b(a)})};var SPModelStaff=function(){this.model="staff"};
SPModelStaff.prototype.allStaff=function(a){if("undefined"==typeof a)return sp.staff.raw.employees;spModel.staff.get("employees",{schedule:a},function(a){return a.data},function(){Log.log("implement");return{}})};
SPModelStaff.prototype.allSkills=function(a){if("undefined"==typeof a)return null==sp.staff.raw.skills?[]:sp.staff.raw.skills;spModel.schedule.get("schedules",{},function(a){sp.staff.raw.skills=a.data;sp.staff.data.skills=sp.map(a.data);return sp.staff.raw.skills},function(){Log.log("implement");return{}})};SPModelStaff.prototype.reset=function(){spModel.staff.get("employees",{},function(a){sp.staff.raw.employees=a.data;sp.staff.data.employees=sp.map(a.data)})};
SPModelStaff.prototype.getEmployeeById=function(a){return"undefined"==typeof sp.staff.data.employees[a]?(sp.showError("Employee doesn't exists"),sp.staff.admin.info):sp.staff.data.employees[a]};SPModelStaff.prototype.addEmployee=function(a){sp.staff.raw.employees.push(a);sp.staff.data.employees[""+a.id]=a};var SPModelPayroll=function(){this.model="payroll"},SPModelLocation=function(){this.model="location"};
SPModelLocation.prototype.locationsList=function(a){if("undefined"!=typeof a&&!0==a)spModel.location.get("locations",{},function(a){sp.staff.raw.locations=a.data;sp.staff.data.locations=sp.map(a.data)});else return sp.staff.data.locations};var SPModelTraining=function(){this.model="training"};function ShiftPlanning(){this.raw={};this.apiCalls={};this.successMessage="";this.initialize();return this.hashChange=!0}
ShiftPlanning.prototype={multiApi:function(a,b){var c=[];$.each(a,function(a,b){var f={module:b[0],method:b[1]};$.each(b[2],function(a,b){f[a]=b});c.push(f)});$.ajax({url:"api.php",dataType:"json",type:"post",data:"multi=1&data="+JSON.stringify(c),cache:!1,success:function(a){$.each(a,function(a,b){if(3==b.status)return sp.hash("logout"),user.loggedIn=0,user.name="",user.company="",sp.staff.data.employees={},window.location.reload(),!1});"function"==typeof b&&b.call(this,a)}})},api:function(a,b,c,
d,e){var f=this,g=a+"."+b+"."+JSON.stringify(c);if("undefined"!=typeof this.apiCalls[g]&&null!=this.apiCalls[g])return!1;var j={module:a,method:b};$.each(c,function(a,b){j[a]=b});this.apiCalls[g]=$.ajax({url:"api.php",dataType:"json",type:"post",data:j,cache:!1,success:function(a){f.apiCalls[g]=null;var b=!0;$.each(f.apiCalls,function(a,c){null!=c&&(b=!1)});b&&($(".bigLoader").hide(),f.apiCalls={});if(3==a.status)user.loggedIn=0,user.name="",user.company="",f.staff.data.employees={},$(".applicationContainer").fadeOut(500,
function(){window.location.reload();$("body").addClass("login");$("html").css("height","100%");$(".loginContainer").fadeIn(500)});else if(1==a.status){if("function"==typeof d){if(!1==a.data||null==a.data)a.data=[];d.call(this,a)}}else"function"==typeof e&&e.call(this,a)}})},loadPage:function(a){user.loggedIn&&"undefined"!=typeof this[a]&&($("#pages #"+a+" > div").hide(),$("#pages #"+a).show(),$(".subNavigation > div").hide(),$(".subNavigation > div."+a).show(),$(".subNavigation > div."+a+" li:first a").trigger(clickEvent),
this[a].loadPage())},nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},map:function(a){if(null==a)return{};var b={};$.each(a,function(){b[""+this.id]=this});return b},hash:function(a){if(a==window.location.hash.substring(1))return window.location.hash.substring(1);"undefined"!=typeof a&&(window.location.hash=a);return window.location.hash.substring(1)},outerHtml:function(a){return $("<div>").append(a.clone()).remove().html()},hasPermission:function(a){return this.staff.admin.info.group<=
a?!0:!1},currentTime:function(){var a=new Date;return months[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()+" - "+a.getHours()+":"+(1==a.getMinutes().length?"0"+a.getMinutes():a.getMinutes())},currentUnixTime:function(){var a=(new Date).getTime();return parseInt(a/1E3)},date:function(a){return(new Date(a)).getDate()},correctTime:function(a){return 10>a?"0"+a:a},strReplace:function(a,b,c,d){var e=0,f=0,g="",j="",i=0,h=0,a=[].concat(a),b=[].concat(b),m="[object Array]"===Object.prototype.toString.call(b),
p="[object Array]"===Object.prototype.toString.call(c),c=[].concat(c);d&&(this.window[d]=0);e=0;for(i=c.length;e<i;e++)if(""!==c[e]){f=0;for(h=a.length;f<h;f++)g=c[e]+"",j=m?void 0!==b[f]?b[f]:"":b[0],c[e]=g.split(a[f]).join(j),d&&c[e]!==g&&(this.window[d]+=(g.length-c[e].length)/a[f].length)}return p?c:c[0]},getAvatar:function(a){"undefined"==typeof a&&(a=sp.staff.admin.info.id);return"undefined"!=typeof sp.staff.data.employees[a]&&"undefined"!=typeof sp.staff.data.employees[a].avatar&&""!=sp.staff.data.employees[a].avatar&&
"undefined"!=typeof sp.staff.data.employees[a].avatar.small?sp.staff.data.employees[a].avatar.small:"images/no-avatar.png"},isL:function(a){return 0<$.trim(a).length?!0:!1},isC:function(a){return $(a).hasClass("check")},countObject:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},countResponse:function(a){return"undefined"==typeof a.length?this.countObject(a):a.length},objToArray:function(a){if("object"==typeof a){var b=[];$.each(a,function(a,d){b.push(d)});a=b}return a}};
var ShiftPlanningModel=function(){this.cache={};this.diff=""};ShiftPlanningModel.prototype.addModel=function(a,b){$.extend(b.prototype,spModel);"undefined"==typeof this[a]&&(this[a]=new b)};
ShiftPlanningModel.prototype.get=function(a,b,c,d){if("undefined"==typeof this[a])sp.api(this.model+"."+a,"get",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,d)});else this[a](a,"get",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,a)})};
ShiftPlanningModel.prototype.update=function(a,b,c,d){if("undefined"==typeof this[a])sp.api(this.model+"."+a,"update",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,d)});else this[a](a,"update",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,a)})};
ShiftPlanningModel.prototype.create=function(a,b,c,d){if("undefined"==typeof this[a])sp.api(this.model+"."+a,"create",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,d)});else this[a](a,"create",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,a)})};
ShiftPlanningModel.prototype.del=function(a,b,c,d){if("undefined"==typeof this[a])sp.api(this.model+"."+a,"delete",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,d)});else this[a](a,"delete",b,function(a){"function"==typeof c&&c.call(this,a)},function(a){sp.showError(a.error);"function"==typeof d&&d.call(this,d)})};ShiftPlanningModel.prototype.set=function(){};
ShiftPlanningModel.prototype.setCache=function(a,b){"unfedined"==typeof this.cache[a]&&(this.cache[a]={});this.cache[a][this.diff]=b};ShiftPlanningModel.prototype.clearCache=function(a){this.cache[a]={}};ShiftPlanningModel.prototype.getCache=function(a){return this.cache[a]};ShiftPlanningModel.prototype.isSetCache=function(a){return"undefined"!=typeof this.cache[a]&&0<this.cache[a].length?!0:!1};
ShiftPlanningModel.prototype.cacheDiff=function(a){if("undefined"!=typeof a)this.diff=JSON.stringify(a);else if(0==this.diff.length)Log.log("Please set diff");else return this.diff;return!0};var spModel=new ShiftPlanningModel;spModel.addModel("schedule",SPModelSchedule);spModel.addModel("requests",SPModelRequests);spModel.addModel("admin",SPModelAdmin);spModel.addModel("messaging",SPModelMessaging);spModel.addModel("timeclock",SPModelTimeClock);spModel.addModel("staff",SPModelStaff);
spModel.addModel("payroll",SPModelPayroll);spModel.addModel("location",SPModelLocation);spModel.addModel("training",SPModelTraining);var ShiftPlanningView=function(){};
ShiftPlanningView.prototype.optionSchedules=function(a,b,c){"undefined"==typeof b&&(b=!1);"undefined"==typeof c&&(c=!1);var d,e=this,a="undefined"==typeof a||0==a?spModel.schedule.allSchedules():spModel.schedule.schedulesByUser(a,c);d='<option disabled="disabled" selected="selected" value="0">'+_("Select Schedule")+"</option>";c?$.each(a,function(a,b){d+='<optgroup label="'+b.name+'">';$.each(b.data,function(a,b){d+='<option value="'+b.id+'">'+b.name+"</option>"});d+="</optgroup>"}):$.each(a,function(a,
b){e.checkPerm(b)&&(d+='<option value="'+a+'">'+("object"==typeof b?b.name:b)+"</option>")});return d};
ShiftPlanningView.prototype.staffOption=function(a){"undefined"==typeof a&&(a=!1);var b;!1==a?(b='<option disabled="disabled" selected="selected" value="0">Select Employee</option>',a=4==sp.staff.admin.info.group?sp.staff.fixed.employees:spModel.staff.allStaff(),$.each(a,function(a,d){b+='<option value="'+d.id+'">'+("object"==typeof d?d.name:d)+"</option>"})):b='<option value="'+sp.staff.admin.info.id+'">'+sp.staff.admin.info.name+"</option>";return b};
ShiftPlanningView.prototype.staffFilter=function(a){"undefined"==typeof a&&(a=!1);var b="";!1==a?(3>=sp.staff.admin.info.group&&(b='<option value="0">All Employees</option>'),a=4==sp.staff.admin.info.group?sp.staff.fixed.employees:spModel.staff.allStaff(),$.each(a,function(a,d){b+='<option value="'+d.id+'">'+("object"==typeof d?d.name:d)+"</option>"})):b='<option value="'+sp.staff.admin.info.id+'">'+sp.staff.admin.info.name+"</option>";return b};
ShiftPlanningView.prototype.scheduleFilter=function(a,b){"undefined"==typeof b&&(b=!1);var c=this,d="",e;e="undefined"==typeof a||0==a?spModel.schedule.allSchedules():spModel.schedule.schedulesByUser(a);3>=sp.staff.admin.info.group&&(d='<option value="0">All Positions</option>');$.each(e,function(a,e){c.checkPerm(e,b)&&(d+='<option value="'+a+'">'+("object"==typeof e?e.name:e)+"</option>")});return d};
ShiftPlanningView.prototype.schedulerFilter=function(a,b){"undefined"==typeof b&&(b=!1);var c=this,d;d="undefined"==typeof a||0==a?spModel.schedule.allSchedules():spModel.schedule.schedulesByUser(a);var e="";$.each(d,function(a,d){c.checkPerm(d,b)&&(e+='<option value="'+a+'">'+("object"==typeof d?d.name:d)+"</option>")});return e};
ShiftPlanningView.prototype.skillsFilter=function(a){"undefined"==typeof a&&(a=!1);var b;!1==a?(b='<option value="0">All Skills</option>',$.each(spModel.staff.allSkills(),function(a,d){b+='<option value="'+d.id+'">'+("object"==typeof d?d.name:d)+"</option>"})):b='<option value="'+sp.staff.admin.info.id+'">'+sp.staff.admin.info.name+"</option>";return b};
ShiftPlanningView.prototype.locationSelector=function(a){"undefined"==typeof a&&(a=2);var b='<option value="0" selected="selected">'+(1==a?"Select Location":"Select Work Site")+"</option>",b=b+'<optgroup lable="locations">';$.each(spModel.location.locationsList(),function(c,d){d.type==a&&(b+='<option value="'+d.id+'">'+d.name+"</option>")});return b+='</optgroup><optgroup><option value="add" type="'+a+'">'+(1==a?"New Location?":"New Work Site?")+"</option></optgroup>"};
ShiftPlanningView.prototype.timeRanges=function(){var a=spRanges.createSelector("times"),b='<option value="-1">Select</option>';$.each(a,function(a,d){b+='<option value="'+a+'" >'+d+"</option>"});return b};
ShiftPlanningView.prototype.customFields=function(a){var b="",c="",d="",e=2,f="";"undefined"!=typeof a.custom&&$.each(a.custom,function(a,d){1==d.toggle&&(f="check");if(4!=d.type){b+="<li>";b+="<div>";switch(d.type){case "1":d.value=null==d.value?"":d.value;b+="<label>"+d.name+": <h4>"+d.value+"</h4></label>";break;case "2":d.text=null==d.text?"":d.text;b+="<label>"+d.name+": <h4>"+d.text+"</h4></label>";break;case "3":d.value=null==d.value?"":d.value,b+="<label>"+d.name+": <h4>"+d.value+"</h4></label>"}b+=
"</div>";b+="</li>"}else c+="<li>",c+='<span item="edit" class="checkbox '+f+'" id='+d.id+">"+d.name+"</span>",c+="</li>",e++,f=""});d=b+c;return 0<d.length?d:this.emptyResult(_s("No custom fields to display"),"li","noBorder")};
ShiftPlanningView.prototype.editableCustomFields=function(a){var b="",c="",d="",e=2,f="";"undefined"!=typeof a.custom&&($.each(a.custom,function(a,d){1==d.toggle&&(f="check");if(4!=d.type){b+="<li>";b+="<div>";switch(d.type){case "1":b+="<label>"+d.name+':</label><span class="input"><input item="edit" id="'+d.id+'" type="text" value="'+d.value+'" name=""></span>';break;case "2":b+="<label>"+d.name+':</label><span class="input"><input item="edit" id="'+d.id+'" type="text" value="'+d.text+'" name=""></span>';
break;case "3":b+="<label>"+d.name+":</label>";b+='<span class="input"><select item="edit" id="'+d.id+'">';b+="<option>"+d.value+"</option>";var i=[],i=d.values.split(",");$.each(i,function(a,c){b+="<option>"+c+"</option>"});b+="</select></span>"}b+="</div>";b+="</li>"}else c+='<li class="'+(0==e%2?"even":"odd")+'">',c+='<span item="edit" class="checkbox '+f+'" id='+d.id+">"+d.name+"</span>",c+="</li>",e++,f=""}),d=b+"<li><ul>"+c+"</ul></li>");return 0<d.length?d:this.emptyResult(_s("No custom fields to display"),
"li","noBorder")};ShiftPlanningView.prototype.editableSchedules=function(a){var b="",c=2;$.each(spModel.schedule.allSchedules(),function(d,e){var f="undefined"!=typeof a.schedules&&"undefined"!=typeof a.schedules[e.id]?'check"':"";b+='<li class="'+(0==c%2?"even":"odd")+'">';b+="  <div>";b+='      <span class="checkbox '+f+'" itemId='+e.id+">"+e.name+"</span>";b+="  </div>";b+="</li>";c++});return 0<b.length?b:this.emptyResult(_s("No positions to display"),"li","noBorder")};
ShiftPlanningView.prototype.editableSkills=function(a){var b="",c=2;$.each(spModel.staff.allSkills(),function(d,e){var f="undefined"!=typeof a.skills&&"undefined"!=typeof a.skills[e.id]?"check":"";b+='<li class="'+(0==c%2?"even":"odd")+'">';b+="  <div>";b+='      <span class="checkbox '+f+'" itemId='+e.id+">"+e.name+"</span>";b+="  </div>";b+="</li>";c++});return 0<b.length?b:this.emptyResult(_s("No skills to display"),"li","noBorder")};ShiftPlanningView.prototype.ulLoader=function(){return'<li class="loading"></li>'};
ShiftPlanningView.prototype.divLoader=function(){return'<div class="loading"></div>'};ShiftPlanningView.prototype.emptyResult=function(a,b,c){"undefined"==typeof c&&(c="");"undefined"==typeof b&&(b="div");"undefined"==typeof a&&(a=_s("Na data for selected criteria!"));return"<"+b+' class="additional '+c+'"><p>'+a+"</p></"+b+">"};ShiftPlanningView.prototype.checkPerm=function(a,b){"undefined"==typeof b&&(b=!1);var c=1;b&&(c=2);var d=!0;"undefined"!=typeof a.perms&&(d=a.perms>=c?!0:!1);return d};
ShiftPlanningView.prototype.fixCurrency=function(a,b){"undefined"==typeof b&&(b=!1);var c=spRanges.currencies[a];if(b)return c;$("span.currency").html(c)};
ShiftPlanningView.prototype.bbc2HTML=function(a){function b(a,b){for(var c in b)a=a.replace(RegExp(c,"g"),b[c]);return a}function c(a,b,h,k){k&&-1<k.indexOf("[")&&(k=k.replace(d,c));switch(b){case "url":case "anchor":case "email":return"<a "+f[b]+(h||k)+'">'+k+"</a>";case "img":return a=e.exec(h),'<img src="'+k+'"'+(a?' width="'+a[1]+'" height="'+a[2]+'"':"")+' alt="'+(a?"":h)+'" />';case "flash":case "youtube":return a=e.exec(h)||[0,425,366],'<object type="application/x-shockwave-flash" data="'+
j[b]+k+'" width="'+a[1]+'" height="'+a[2]+'"><param name="movie" value="'+j[b]+k+'" /></object>';case "float":return'<span style="float: '+h+'">'+k+"</span>";case "left":case "right":case "center":case "justify":return'<div style="text-align: '+b+'">'+k+"</div>";case "google":case "wikipedia":return'<a href="'+g[b]+k+'">'+k+"</a>";case "b":case "i":case "u":case "s":case "sup":case "sub":case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":case "table":case "tr":case "th":case "td":return"<"+
b+">"+k+"</"+b+">";case "row":case "r":case "header":case "head":case "h":case "col":case "c":return"<"+i[b]+">"+k+"</"+i[b]+">";case "acronym":case "abbr":return"<"+b+' title="'+h+'">'+k+"</"+b+">"}return"["+b+(h?"="+h:"")+"]"+k+"[/"+b+"]"}if(0>a.indexOf("["))return a;var d=RegExp("\\[([a-z][a-z0-9]*)(?:=([^\\]]+))?]((?:.|[\r\n])*?)\\[/\\1]","g"),e=RegExp("^(\\d+)x(\\d+)$",void 0),f={url:'href="',anchor:'name="',email:'href="mailto: '},g={google:"http://www.google.com/search?q=",wikipedia:"http://www.wikipedia.org/wiki/"},
j={youtube:"http://www.youtube.com/v/",flash:""},i={row:"tr",r:"tr",header:"th",head:"th",h:"th",col:"td",c:"td"},h={notag:[{"\\[":"&#91;","]":"&#93;"},"",""],code:[{"<":"&lt;"},"<code><pre>","</pre></code>"]};h.php=[h.code[0],h.code[1]+"&lt;?php ","?>"+h.code[2]];var m={font:"font-family:$1",size:"font-size:$1px",color:"color:$1"},p={c:"circle",d:"disc",s:"square",1:"decimal",a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"},q={},l={},n;for(n in h)q["\\[("+n+")]((?:.|[\r\n])*?)\\[/\\1]"]=
function(a,c,d){return h[c][1]+b(d,h[c][0])+h[c][2]};for(n in m)l["\\["+n+"=([^\\]]+)]"]='<span style="'+m[n]+'">',l["\\[/"+n+"]"]="</span>";l["\\[list]"]="<ul>";l["\\[list=(\\w)]"]=function(a,b){return'<ul style="list-style-type: '+(p[b]||"disc")+'">'};l["\\[/list]"]="</ul>";l["\\[\\*]"]="<li>";l["\\[/\\*]"]="</li>";l["\\[quote(?:=([^\\]]+))?]"]=function(a,b){return'<div class="bb-quote">'+(b?b+" wrote":"Quote")+":<blockquote>"};l["\\[/quote]"]="</blockquote></div>";l["\\[(hr|br)]"]="<$1 />";l["\\[sp]"]=
"&nbsp;";return b(b(a,q),l).replace(d,c)};ShiftPlanningView.prototype.friendly_filesize=function(a){for(var b=["TB","GB","MB","kB","b"],c=[1099511627776,1073741824,1048576,1024,1],d=0;d<c.length;d++){var e=a/c[d];if(1<e)return Math.round(10*e)/10+" "+b[d]}};
var spView=new ShiftPlanningView,ShiftPlanningRanges=function(){this.times={"0":{title:"Today",start_time:Date.parse("today").getTime(),end_time:Date.parse("today").add(1).days().getTime()},1:{title:"Yesterday",start_time:Date.parse("yesterday").getTime(),end_time:Date.parse("yesterday").add(1).days().getTime()},2:{title:"Last 7 Days",start_time:1E3*strtotime("now -7 day"),end_time:1E3*strtotime("tomorrow")},3:{title:"This Week",start_time:Date.parse("sunday").getTime(),end_time:Date.parse("next saturday").getTime()},
4:{title:"Last Week",start_time:Date.parse("today").moveToDayOfWeek(0).addWeeks(-2).getTime(),end_time:Date.parse("previous saturday").getTime()},5:{title:"This Month",start_time:1E3*strtotime("now -"+(now().getDate()-1)+" days"),end_time:Date.parse("today").moveToLastDayOfMonth().getTime()},6:{title:"Last Month",start_time:1E3*strtotime("now -"+(now().getDate()+30)+" days"),end_time:1E3*strtotime("now -"+now().getDate()+" days")},7:{title:"One Year",start_time:1E3*strtotime("last year"),end_time:1E3*
strtotime("now")}};this.currencies=" $ &#163; &#8364; &#8360; &#165; &#8361; R kr &#8369; RM".split(" ");this.weekdays={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat",7:"Sun"};this.months="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")};
ShiftPlanningRanges.prototype.fixRanges=function(){var a=this,b=6E4*Date.parse("now").getTimezoneOffset(),c=sp.staff.admin.settings.timezone.split(","),c=c[0].split(":"),d=3600*parseInt(c[0]),e=3600*parseInt(c[0])/Math.abs(3600*parseInt(c[0])),f=60*c[1];$.each(this.times,function(c,j){a.times[c].start_date=j.start_date+b+1E3*e*(Math.abs(d)+f);a.times[c].end_date=j.end_date+b+1E3*e*(Math.abs(d)+f)});a.times[3]={title:"This Week",start_time:Date.parse("sunday").add(sp.staff.admin.settings.startday-
1).days().getTime(),end_time:Date.parse("next saturday").add(sp.staff.admin.settings.startday-1).days().getTime()};a.times[4]={title:"Last Week",start_time:Date.parse("today").moveToDayOfWeek(0).addWeeks(-2).add(sp.staff.admin.settings.startday-1).days().getTime(),end_time:Date.parse("previous saturday").add(sp.staff.admin.settings.startday-1).days().getTime()}};ShiftPlanningRanges.prototype.getRange=function(a,b){return this[a][b]};
ShiftPlanningRanges.prototype.createSelector=function(a){var b=[];$.each(this[a],function(a,d){b.push(d.title)});return b};var spRanges=new ShiftPlanningRanges;function ShiftPlanningStaff(){this.changed=!0;this.page=6;this.initialize();return!0}ShiftPlanningStaff.prototype={data:{},raw:{},fixed:{},admin:{},initialize:function(){},login:function(){},loadPage:function(){}};
function ShiftPlanningSchedule(){this.initialize();this.fix=86E3;this.raw={};this.data={};this.prepared={};this.shifts={};this.shift={};this.fromStaff=this.fromDashboardUpcoming=this.fromUpcoming=this.fromRecent=this.fromDashboard=this.edit=this.loaded=!1;this.state=1;this.settings={mode:"employee",start_date:"yesterday",end_date:"yesterday"};this.page="today";this.conflicts={};return!0}
ShiftPlanningSchedule.prototype={initialize:function(){},loadPage:function(){},setConflicts:function(a){var b=this;$.each(a,function(a,d){b.conflicts[d.shift+""]=d})}};function ShiftPlanningDashboard(){this.initialize()}ShiftPlanningDashboard.prototype={templates:{},initialize:function(){},loadPage:function(){}};function ShiftPlanningTimeClock(){this.initialize();this.timeSheetsData={};this.actco=!1;this.current={};this.edit=!1;return!0}
ShiftPlanningTimeClock.prototype={times:{"0":{start_time:strtotime("now"),end_time:strtotime("now +1 day")},1:{start_time:strtotime("now -1 day"),end_time:strtotime("now")},2:{start_time:strtotime("now -7 day"),end_time:strtotime("now +1 day")},3:{start_time:Date.parse("monday").getTime()/1E3,end_time:Date.parse("next sunday").getTime()/1E3},4:{start_time:Date.parse("monday").getTime()/1E3-604800,end_time:Date.parse("sunday").getTime()/1E3}}};
var ShiftPlanningReports=function(){this.initialize();this.skills=this.employees=this.positions=this.locations="";this.page="allReports";this.timeLine=""};
ShiftPlanningReports.prototype={initialize:function(){},loadPage:function(){},times:{"0":{start_time:strtotime("now"),end_time:strtotime("now +1 day")},1:{start_time:strtotime("now -2 day"),end_time:strtotime("now")},2:{start_time:strtotime("now -7 day"),end_time:strtotime("now")},3:{start_time:Date.parse("monday").getTime()/1E3,end_time:Date.parse("next sunday").getTime()/1E3},4:{start_time:Date.parse("monday").getTime()/1E3-604800,end_time:Date.parse("sunday").getTime()/1E3},5:{start_time:strtotime("now -"+
(now().getDate()-1)+" days"),end_time:strtotime("now +1 day")},6:{start_time:strtotime("now -"+(now().getDate()+30)+" days"),end_time:strtotime("now -"+(now().getDate()-1)+" days")},7:{start_time:strtotime("last year"),end_time:strtotime("now +1 day")}}};var ShiftPlanningRequests=function(){this.initialize();this.employees=this.positions="";this.shifts=[];this.shiftsR=[];this.vacations=[];this.swaps={};this.current={};this.available={};this.trades={manage:[],requested:[],avaiting:[]}};
ShiftPlanningRequests.prototype={initialize:function(){},loadPage:function(){}};function ShiftPlanningLocation(){this.initialize();return!0}
ShiftPlanningLocation.prototype={data:{},raw:{},initialize:function(){$(document).ready(function(){$("#wrapper").delegate("select.locations","change",function(){var a=$(this);if("add"==$(this).val()){var b=prompt(_s("Enter location name."),"");null!=b&&spModel.location.create("location",{name:b,type:$(this).find("option:last").attr("type")},function(b){a.find("optgroup:first").append('<option value="'+b.data.id+'">'+b.data.name+"</option>");a.val(a.find("optgroup:first option:last").val());spModel.location.locationsList(!0)})}})})}};
var ShiftPlanningPermissions=function(){this.superUser=1;this.manager=2;this.supervisor=3;this.scheduler=4;this.employee=5;this.employees={};this.initialize()};ShiftPlanningPermissions.prototype={initialize:function(){}};function ShiftPlanningTraining(){this.initialize();this.top=this.tmp_section=this.tmp_module=0;this.scrollWindow=!1;this.trainings={};this.statistic=[]}function ShiftPlanningSettings(){this.initialize()}
ShiftPlanningStaff.prototype.initialize=function(){var a=this;$(document).ready(function(){1==user.loggedIn&&a.prepareConfig();$("#lo_b").bind(clickEvent,function(){a.login()});$("#lo_f .checkbox").bind(clickEvent,function(){$(this).toggleClass("check")});a.listEvents();a.addStaffEvents();a.fastAssignmentEvents()})};ShiftPlanningStaff.prototype.loadSubPageEvents=function(a){$("#st_tp_menu").hide();this[a+"SubEvents"]()};
ShiftPlanningStaff.prototype.listEvents=function(){var a=this;$("#st_sn_ga").bind(clickEvent,function(){if($(this).hasClass("active"))return!1;$("#st_sn_ga").addClass("active");$("#st_sn_li").removeClass("active");$("#st_li_ga").removeClass("small").addClass("big")});$("#st_sn_li").bind(clickEvent,function(){if($(this).hasClass("active"))return!1;$("#st_sn_li").addClass("active");$("#st_sn_ga").removeClass("active");$("#st_li_ga").removeClass("big").addClass("small")});$("#st_li_se_b").bind(clickEvent,
function(a){a.preventDefault();a=$("#st_li_se_te").val();0==a.length||"Search..."==a?($("#st_li_ga li").show(),$("#st_li_ga").show(),$("#st_li .noResults").hide()):($("#st_li_ga li").hide(),$("#st_li_ga").show(),$("#st_li .noResults").hide(),$("#st_li_ga li").find('span:Contains("'+a+'")').parents("li").show(),0==$("#st_li_ga li").find('span:Contains("'+a+'")').parents("li").length&&($("#st_li .noResults").show(),$("#st_li_ga").hide()))});$("#st_li_se_te").bind("keyup",function(){$("#st_li_se_b").trigger(clickEvent)});
$("#st_li_ga").delegate("li",clickEvent,function(){var b=$(this).attr("staffId");sp.permissions.hasPermission("visible_staff_details")&&(window.scrollTo(0,1),a.displayEmployee(b))})};ShiftPlanningStaff.prototype.addStaffEvents=function(){var a=this;$("#st_ae_sa").bind(clickEvent,function(){$(this).toggleClass("check")});$("#st_ae_ce_b").bind(clickEvent,function(b){b.preventDefault();a.createEmployee($(this))})};
ShiftPlanningStaff.prototype.fastAssignmentEvents=function(){var a=this;$("#st_fa_el").bind("change",function(){a.loadFastAssignment($(this).val())});$("#st_fa ul.detailsGrid ul").delegate(".checkbox",clickEvent,function(){var a=$(this).attr("itemId"),c=0<$(this).parents(".skills").length?!0:!1,d=$(this).hasClass("check")?!0:!1,e=this;$(e).parent().addClass("loading");var f={id:$("#st_fa_cu").val()};c?d?f.removeskill=a:f.addskill=a:d?f.removeschedule=a:f.addschedule=a;spModel.staff.update("employee",
f,function(a){d?$(e).removeClass("check"):$(e).addClass("check");$(e).parent().removeClass("loading");sp.settings.updateUser($("#st_fa_cu").val(),a,!1)})})};ShiftPlanningStaff.prototype.listSubEvents=function(){$("#st_tp_menu").show();$("#st_li_ga").html($.tmpl($("#te_st_list"),spModel.staff.allStaff()));$("#st_li_ga li").show();$("#st_li_se_te").val("").trigger("blur")};ShiftPlanningStaff.prototype.addStaffSubEvents=function(){this.resetAddEmployee()};
ShiftPlanningStaff.prototype.fastAssignmentSubEvents=function(){$("#st_fa_el").html(spView.staffOption());$("#st_fa_po").hide();$("#st_fa_sk").hide()};
ShiftPlanningStaff.prototype.displayEmployee=function(a){sp.hashChange=!1;sp.hash("staff/details");$("#st_tp_menu").hide();$("#pages > div").hide();$("#pages #settings .main").hide();$("#pages #settings .mainSub").hide();$("#pages #settings").show();$("#da_se_overview").show();sp.settings.overviewSubEvents(spModel.staff.getEmployeeById(a));$("#settings .mainSub.settings .subNav li:first a").trigger(clickEvent);$(".subNavigation").hide();$("#pages #settings .mainSub.settings").show()};
ShiftPlanningStaff.prototype.loadFastAssignment=function(a){var b=spModel.staff.getEmployeeById(a);$("#st_fa_cu").val(a);$("#st_fa_po ul.detailsGrid ul").html(spView.editableSchedules(b));$("#st_fa_sk ul.detailsGrid ul").html(spView.editableSkills(b));$("#st_fa_po").show();$("#st_fa_sk").show();sp.fixCheckboxes()};
ShiftPlanningStaff.prototype.createEmployee=function(a){$(a).addClass("loading");var b=this,c={};c.name=$("#st_ae_i_n").val();c.nick_name=$("#st_ae_i_nn").val();c.email=$("#st_ae_i_e").val();c.eid=$("#st_ae_i_eid").val();c.username=$("#st_ae_i_un").val();c.wage=$("#st_ae_i_hw").val();c.notes=$("#st_ae_i_no").val();$("#st_ae_sa").hasClass("check")&&(c.send_activation=1);spModel.staff.create("employee",c,function(c){$(a).removeClass("loading");spModel.staff.addEmployee(c.data);b.displayEmployee(c.data.id);
sp.showSuccess(_s("Employee successfully created!"))},function(){$(a).removeClass("loading")})};ShiftPlanningStaff.prototype.resetAddEmployee=function(){$("#st_ae_i_n").val("");$("#st_ae_i_nn").val("");$("#st_ae_i_e").val("");$("#st_ae_i_eid").val("");$("#st_ae_i_un").val("");$("#st_ae_i_hw").val("");$("#st_ae_i_no").val("");$("#st_ae_sa").removeClass("check")};
ShiftPlanningStaff.prototype.login=function(){var a=$("#lo_u").val(),b=$("#lo_p").val(),c=this;$("#lo_b").addClass("loading");sp.api("staff.login","GET",{username:a,password:b},function(a){sp.staff.admin.info=a.data.employee;null==a.data.employee.language&&(a.data.employee.language=a.data.business.language);setCookie("shiftplanning_mobile_lang",a.data.employee.language,cookieExpire);"en_US"!=a.data.employee.language&&window.location.reload();sp.multiApi([["staff.employees","GET",{}],["schedule.schedules",
"GET",{perms:1}],["admin.settings","GET",{}],["staff.skills","GET",{}],["location.locations","GET",{}]],function(b){sp.api("api.config","GET",{},function(f){sp.api("admin.business","GET",{},function(g){$(".loginContainer").fadeOut(500,function(){$("#lo_b").removeClass("loading");user.loggedIn=1;user.name=a.data.employee.name;user.company=a.data.business.name;user.phone=a.data.business.phone;sp.staff.raw.employees=b[0].data;sp.staff.data.employees=sp.map(b[0].data);sp.schedule.raw.schedules=b[1].data;
sp.schedule.data.schedules=sp.map(b[1].data);sp.staff.admin.settings=b[2].data;sp.staff.raw.skills=b[3].data;sp.staff.data.skills=sp.map(b[3].data);sp.staff.raw.locations=b[4].data;sp.staff.data.locations=sp.map(b[4].data);sp.staff.admin.info.dfAvatar=sp.getAvatar(sp.staff.admin.info.id);sp.raw.config=f.data;sp.schedule.dateId=sp.raw.config.today.id;sp.staff.admin.business=g.data;$("body").removeClass("login");$(".notification").remove();$("html").css("height","auto");sp.hash("dashboard");c.prepareConfig();
sp.permissions.preparePermissions();spRanges.fixRanges();sp.staff.fixed.employees=sp.permissions.fixStaffListing();sp.raw.config.today.formatted=Date.parse(sp.raw.config.today.formatted).toString(cal.dformat);$("#lo_f .checkbox").hasClass("check")&&(setCookie("shiftplanning_mobile_rememberme",1,cookieExpire),setCookie("shiftplanning_mobile_usertoken",a.token,cookieExpire),setCookie("shiftplanning_mobile_userid",a.data.employee.id,cookieExpire),setCookie("shiftplanning_mobile_username",user.name,cookieExpire),
setCookie("shiftplanning_mobile_usercompany",user.company,cookieExpire),setCookie("shiftplanning_mobile_userphone",user.phone,cookieExpire))})})})})},function(a){$("#lo_b").removeClass("loading");$(".login .error").html(a.error);$(".login .error").slideDown(500);$(".login input:first").focus()})};
ShiftPlanningStaff.prototype.logout=function(){if(!confirm(_s("Are you sure you want to logout?"))){var a=$("#menu .mainNav .active").attr("id").split("_");sp.hash(a[1]);return!1}sp.api("staff.logout","GET",{},function(){setCookie("shiftplanning_mobile_rememberme",0,cookieExpire);window.location.reload()},function(a){sp.showError(a.error)})};
ShiftPlanningStaff.prototype.prepareConfig=function(){var a=new Date,b=a.getMonth(),c=a.getFullYear(),d=a.getDate();cal={startday:sp.staff.admin.settings.startday,currency:{1:"$",2:"&#163;",3:"&#8364;",4:"&#8360;",5:"&#165;",6:"&#8361;",7:"R",8:"kr",9:"&#8369;",10:"RM"}[sp.staff.admin.settings.currency],tmode:"1"==sp.staff.admin.settings["24hr"]?24:12,tstring:1==parseInt(sp.staff.admin.settings["24hr"])?"HH:mm":"h:mm tt",dformat:sp.strReplace(["M","d","m","Y","j"],["MMM","dd","MM","yyyy","d"],sp.staff.admin.settings.date),
dpformat:sp.strReplace(["d","m","Y","M","j"],["dd","mm","yy","M","d"],sp.staff.admin.settings.date),user:sp.staff.admin.info.id,view:"week",mode:"overview",schedule:"",lastlength:8,focus:"employee",today:a.getMonth()+"/"+a.getDate()+"/"+a.getFullYear(),month:b,year:c,day:d,firstday:"",lastday:"",cache:{},lastcall:"",firsttime:0,height:960,timeline:{},shifts:{},schedules:{},locations:{},skills:{},employees:{},total:{},conflicts:{},locked:0}};
ShiftPlanningDashboard.prototype.initialize=function(){var a=this;$(document).ready(function(){a.dashboardEvents();a.wallEvents();a.inboxEvents();a.settingsEvents();a.upcomingShiftsEvents();a.whosonnowEvents();a.filesEvents();a.fixes()})};
ShiftPlanningDashboard.prototype.loadSubPageEvents=function(a){switch(a){case "wall":this.wallSubEvents();break;case "upcomingShifts":this.upcomingShiftsSubEvents();break;case "files":this.filesSubEvents();break;case "inbox":this.inboxSubEvents();break;case "settings":this.settingsSubEvents();break;case "whosonnow":this.whosonnowSubEvents();break;case "dashboard":this.dashboardSubEvents();break;case "logout":sp.staff.logout();break;case "pingUser":this.pingUser()}};
ShiftPlanningDashboard.prototype.dashboardEvents=function(){$("#da_widgets").delegate(".timeClock a",clickEvent,function(a){a.preventDefault();sp.loadSubPage("","timeClock","overview")});$("#da_widgets").delegate(".tradePage",clickEvent,function(a){a.preventDefault();sp.loadSubPage("","requests","available")});$("#da_widgets").delegate("ul.shifts a",clickEvent,function(a){a.preventDefault();$(this).addClass("loading");spModel.schedule.get("shift",{id:$(this).attr("rel"),detailed:1},function(a){sp.schedule.fromDashboard=
!0;sp.schedule.shift=a.data;sp.loadSubPage("","schedule","shiftDisplay")})});$("#da_widgets").delegate(".schedule a",clickEvent,function(a){a.preventDefault();$("#menu_schedule a").trigger(clickEvent)});$("#da_widgets").delegate(".user a",clickEvent,function(a){a.preventDefault();$("#menu_settings a").trigger(clickEvent)})};
ShiftPlanningDashboard.prototype.wallEvents=function(){var a=this;$("#da_wa_nm_b").bind(clickEvent,function(a){a.preventDefault();$("#da_wa_nm_f").toggleClass("hidden");$("#da_wa_nm_ti").val("");$("#da_wa_nm_me").val("")});$("#da_wa_nm_st").bind(clickEvent,function(a){a.preventDefault();$(this).toggleClass("check")});$("#da_wa_nm_ca").bind(clickEvent,function(a){a.preventDefault();$("#da_wa_nm_b").trigger(clickEvent)});$("#da_wa_nm_sa").bind(clickEvent,function(b){b.preventDefault();var c=$(this);
c.addClass("loading");b={};b.title=sp.isL($("#da_wa_nm_ti").val())?$.trim($("#da_wa_nm_ti").val()):"";if(!sp.isL($("#da_wa_nm_me").val()))return sp.showError(_s("Message must be entered")),!1;b.post=$.trim($("#da_wa_nm_me").val());spModel.messaging.create("wall",b,function(){c.removeClass("loading");$("#da_wa_nm_f").toggleClass("hidden");$("#da_wa_nm_ti").val("");$("#da_wa_nm_me").val("");a.wallSubEvents()},function(){c.removeClass("loading")})});$("#da_wa_li").delegate(".msgRpl, .cmtCount",clickEvent,
function(a){a.preventDefault();a=$(this).attr("rel");$("#da_wa_msg_"+a).find(".cmts").is(":visible")?($(this).hasClass("msgRpl")&&$("#da_wa_msg_"+a).find("input[type=text]").val($("#da_wa_msg_"+a).find("input[type=text]").attr("origin")),$("#da_wa_msg_"+a).find(".cmtCount").show(),$("#da_wa_msg_"+a).find(".cmts").hide()):($("#da_wa_msg_"+a).find(".cmtCount").hide(),$("#da_wa_msg_"+a).find(".cmts").show(),$(this).hasClass("msgRpl")&&$("#da_wa_msg_"+a).find("input[type=text]").focus())});$("#da_wa_li").delegate(".msgDel",
clickEvent,function(a){a.preventDefault();var c=$(this);if(confirm(_s("Do you want to delete this message?"))){var a=$(this).attr("rel"),d="message";$(this).hasClass("comment")&&(d="comment");spModel.messaging.del("wall",{id:a,"delete":d},function(){c.parent().fadeOut("fast",function(){$(this).remove()})})}});$("#da_wa_li").delegate("input[type=text]","focus",function(){$(this).attr("origin",$(this).val());$(this).val("")});$("#da_wa_li").delegate("input[type=submit]",clickEvent,function(){var a=
$(this),c=$(this).attr("rel"),d=$.trim($("#da_wa_msg_"+c+" input[type=text]").val());if(0==d.length||"Write a comment..."==d)return alert(_s("Please write your message")),!1;spModel.messaging.create("wall",{post:d,id:c},function(){var e={avatar:sp.staff.admin.info.dfAvatar,id:c,userName:sp.staff.admin.info.name,comment:d,time:"Now",full:!1};a.parent().before($.tmpl($("#te_da_wa_me_co"),e));$("#da_wa_msg_"+c+" input[type=text]").val("Write a comment...")});return!0});$("#da_wa_li").delegate("input[type=text]",
"keyup",function(a){13==(a.keyCode?a.keyCode:a.which)&&$(this).parent().parent().find("input[type=submit]").trigger(clickEvent)})};ShiftPlanningDashboard.prototype.filesEvents=function(){};
ShiftPlanningDashboard.prototype.upcomingShiftsEvents=function(){$("#da_up .shifts a").bind(clickEvent,function(a){a.preventDefault();sp.loadSubPage("","schedule","today")});$("#da_up_li").delegate("li a",clickEvent,function(a){a.preventDefault();$(this).addClass("loading");spModel.schedule.get("shift",{id:$(this).attr("rel"),detailed:1},function(a){sp.schedule.fromDashboardUpcoming=!0;sp.schedule.shift=a.data;sp.loadSubPage("","schedule","shiftDisplay")})})};
ShiftPlanningDashboard.prototype.inboxEvents=function(){var a=this;$("#da_in_me").delegate(".msgHead",clickEvent,function(a){a.preventDefault();var a=$(this).attr("messageId"),c=$(this);c.hasClass("extended")?c.parent().toggleClass("extended"):($(c).addClass("loading"),spModel.messaging.update("message",{id:a,read:1},function(){c.parent().toggleClass("extended");c.parent().removeClass("unread");$(c).removeClass("loading")}))});$("#da_in_nm_b, #da_in_nm_ca").bind(clickEvent,function(a){a.preventDefault();
$("#da_in_nm_f").toggleClass("hidden");$("#da_in_nm_ti").val("");$("#da_in_nm_me").val("");$("#da_in_nm_to").val(0)});$("#da_in_nm_sa").bind(clickEvent,function(){a.sendMessage()});$("#da_in_me").delegate("a.butRpl",clickEvent,function(a){a.preventDefault();var c=$(this).attr("rel");$("#da_in_msg_"+c).find(".newMsg").show(function(){$(this).find("input[type=text]").val("re: "+$("#da_in_msg_"+c).find(".msgHead h5").html())})});$("#da_in_me").delegate("a.butDel",clickEvent,function(a){a.preventDefault();
if(!confirm(_s("Are you sure you want to delete this messaage?")))return!1;var c=$(this).attr("rel");spModel.messaging.del("message",{id:c},function(){$("#da_in_msg_"+c).fadeOut("fast",function(){$(this).remove()})})});$("#da_in_me").delegate(".msgBody .newMsg .title .fr",clickEvent,function(b){b.preventDefault();var b=$(this).parents(".newMsg"),c=$(this).find("a");c.addClass("loading");b={subject:b.find("input[type=text]").val(),message:b.find("textarea").val(),to:b.find("input[type=hidden]").val()};
spModel.messaging.create("message",b,function(){a.inboxSubEvents()},function(){c.removeClass("loading")})});$("#da_in_me").delegate(".msgBody .newMsg .title .fl",clickEvent,function(a){a.preventDefault();a=$(this).parents(".newMsg");a.find("input[type=text]").val("");a.find("textarea").val("");a.hide("fast")})};ShiftPlanningDashboard.prototype.settingsEvents=function(){};
ShiftPlanningDashboard.prototype.whosonnowEvents=function(){var a=this;$("#da_wo .timeSheet").delegate("a.fr",clickEvent,function(b){b.preventDefault();a.pingID=$(this).attr("userID");b=sp.staff.data.employees[a.pingID];0==b.cell_phone.length&&null==b.email||0==b.email.length?sp.showError("This user haven't set cell phone or email"):sp.loadSubPage("","dashboard","pingUser")});$("#pingUser .backMenu").bind(clickEvent,function(a){a.preventDefault();$("#da_who_tmpl div").unbind(clickEvent);$("#da_who_send").unbind(clickEvent);
$(".subNavigation .dashboard li.active a").trigger("click")})};ShiftPlanningDashboard.prototype.wallSubEvents=function(){0!=parseInt(sp.staff.admin.settings.message_wall_on)&&($("#da_wa_li").html(spView.ulLoader()),spModel.messaging.get("wall",{},function(a){0<a.data.length?$("#da_wa_li").html($.tmpl($("#te_da_wa_me"),a.data)):$("#da_wa_li").html(spView.emptyResult(_s("No wall messages"),"li"))},function(){$("#da_wa_li").html(spView.emptyResult(_s("Something went wrong"),"li"))}))};
ShiftPlanningDashboard.prototype.filesSubEvents=function(){$("#da_fi_list").html(spView.ulLoader());spModel.admin.get("files",{},function(a){$.each(a.data,function(){switch(this.extension){case "jpg":case "jpeg":case "png":case "bmp":this.extraclass="image";break;case "txt":case "doc":this.extraclass="txt";break;case "xls":case "csv":this.extraclass="doc";break;case "pdf":this.extraclass="pdf";break;default:this.extraclass="other"}this.file_size=spView.friendly_filesize(this.file_size)});0==a.data.length?
$("#da_fi_list").html(spView.emptyResult(_s("Currently no files for download"),"li")):$("#da_fi_list").html($.tmpl($("#te_da_fi_list"),a.data));$("#da_fi_list li:even").addClass("regular")})};
ShiftPlanningDashboard.prototype.upcomingShiftsSubEvents=function(){$("#da_up_li").html(spView.ulLoader());var a={start_date:"today",end_date:"today +2 months",mode:"employee"};a.employees=sp.staff.admin.info.id;spModel.schedule.get("shifts",a,function(a){var c=[];"undefined"!=typeof a.data&&0<a.data.length&&(c=a.data);0<c.length?$("#da_up_li").html($.tmpl($("#te_da_widget_shift"),c)):$("#da_up_li").html(spView.emptyResult(_s("No upcoming shifts"),"li"))})};
ShiftPlanningDashboard.prototype.inboxSubEvents=function(){$("#da_in_me").html(spView.ulLoader());spModel.messaging.get("messages",{mode:"to"},function(a){0<a.data.length?$("#da_in_me").html($.tmpl($("#te_da_wa_in"),a.data)):$("#da_in_me").html(spView.emptyResult(_s("No messages in your inbox"),"li"))},function(){$("#da_in_me").html(spView.emptyResult(_s("Something went wrong"),"li"))});$("#da_in_nm_to").html(spView.staffOption())};
ShiftPlanningDashboard.prototype.whosonnowSubEvents=function(){$("#wrapper > .subNavigation").show();this.getWhosOn()};
ShiftPlanningDashboard.prototype.dashboardSubEvents=function(){$("#da_widgets .widgets").html(spView.ulLoader());$("#da_widgets ul.shifts.listing").hide();sp.multiApi([["timeclock.status","GET",{details:1}],["schedule.shifts","GET",{mode:"open"}],["schedule.trades","GET",{}],["schedule.shifts","GET",{start_date:"today",end_date:"today +2 months",mode:"employee"}],["schedule.trades","get",{mode:"swap"}]],function(a){$("#da_widgets .widgets").html("");$("#da_widgets .widgets").append($.tmpl($("#te_da_widget_profile"),
{avatar:sp.getAvatar(),name:user.name,company:user.company}));0!=parseInt(sp.staff.admin.settings.timeclock)&&("out"!=a[0].data?$("#da_widgets .widgets").append($.tmpl($("#te_da_widget_timeclock_in"),{time:a[0].data.current_length.hours+_s("h")+" "+a[0].data.current_length.mins+_("mins")})):$("#da_widgets .widgets").append($.tmpl($("#te_da_widget_timeclock_out"))));$("#da_widgets .widgets").append($.tmpl($("#te_da_widget_tradePage"),{count:sp.countResponse(a[1].data)+sp.countResponse(a[2].data)+sp.countResponse(a[4].data)}));
var b=0;$.each(a[3].data,function(a,d){d.start_date.id==sp.raw.config.today.id&&b++;if(d.start_date.id>sp.raw.config.today)return!1});$("#da_widgets .widgets").append($.tmpl($("#te_da_widget_schedule"),{month:sp.raw.config.today.mname.toUpperCase(),day:sp.raw.config.today.day,count:b}));0<a[3].data.length?($("#da_widgets ul.shifts.listing").show(),$("#da_widgets ul.shifts.listing").html($.tmpl($("#te_da_widget_shift"),a[3].data))):$("#da_widgets ul.shifts.listing").hide();$(".applicationContainer").fadeIn(500)})};
ShiftPlanningDashboard.prototype.preparePasswordField=function(){$("#da_se_pa_np").val("");$("#da_se_pa_cp").val("")};
ShiftPlanningDashboard.prototype.getWhosOn=function(){var a=[];$("#da_wo_li").html(spView.ulLoader());spModel.schedule.get("shifts",{mode:"onnow"},function(b){var c=0;$.each(b.data,function(b,e){"undefined"!=typeof e.employees&&null!=e.employees&&$.each(e.employees,function(b,d){var j={userID:d.id,avatar:sp.getAvatar(d.id),name:d.name,position:e.schedule_name,start_time:e.start_time.time,end_time:e.end_time.time};c++;a.push(j)})});0==c?$("#da_wo_li").html(spView.emptyResult("No one is scheduled to work right now.",
"li")):$("#da_wo_li").html($.tmpl($("#te_da_onnow"),a))})};ShiftPlanningDashboard.prototype.pingUser=function(){var a=this,b=sp.staff.data.employees[a.pingID];b.company=user.company;b.company_phone=user.phone;$("#wrapper > .subNavigation").hide();$("#da_who_ping").html($.tmpl($("#te_da_ping"),b));$("#da_who_tmpl div.title1").bind(clickEvent,function(){$("#da_who_txt").val($(this).find("span").html())});$("#da_who_send").bind(clickEvent,function(b){b.preventDefault();a.sendPingMessage()})};
ShiftPlanningDashboard.prototype.sendPingMessage=function(){var a=$("#da_who_txt").val();spModel.staff.create("ping",{to:this.pingID,message:a},function(){sp.showSuccess("Ping sent to user");setTimeout(function(){$("#pingUser .backMenu").trigger("click")},3E3)})};
ShiftPlanningDashboard.prototype.sendMessage=function(){var a=this,b={subject:$("#da_in_nm_ti").val(),message:$("#da_in_nm_me").val(),to:$("#da_in_nm_to").val()};spModel.messaging.create("message",b,function(){$("#da_in_nm_b").trigger(clickEvent);a.inboxSubEvents()})};ShiftPlanningDashboard.prototype.fixes=function(){$("#dashboard .mainSub ul li a[subpage]").shorten();$(".mainNav a[page]").shorten()};
ShiftPlanningStaff.prototype.getStaff=function(a){sp.api("staff.employees","get",{},function(b){sp.staff.raw.employees=b.data;sp.staff.data.employees=sp.map(b.data);"undefined"!=typeof a&&a()},function(a){sp.showError(a.error)})};ShiftPlanningDashboard.prototype.loadPage=function(){};ShiftPlanningTimeClock.prototype.initialize=function(){var a=this;$(document).ready(function(){a.overviewEvents();a.addClockTimeEvents();a.manageTimeSheetsEvents();a.displayTimeSheetsEvents()})};
ShiftPlanningTimeClock.prototype.loadSubPageEvents=function(a){$(".subNavigation").show();"displayTimeClock"==a&&$(".subNavigation").hide();this[a+"SubEvents"]()};
ShiftPlanningTimeClock.prototype.overviewEvents=function(){var a=this;$("#tc_ov_ci").bind(clickEvent,function(a){a.preventDefault();var c={},d=!1,e=function(){spModel.timeclock.get("clockin",c,function(a){$("#tc_ov_cb span.fr a").hide();$("#tc_ov_way_msg").hide();$("#tc_ov_cf").show();$("#tc_ov_co").show();$("#tc_ov_ca").attr("rel",a.data.id);$("#tc_ov_no").val("");$("#tc_ov_ss").val(0)})},f=function(){d=!0;sp.showError(_s("Coordinates not available"));setTimeout(e,2E3)};"1"==sp.staff.admin.business.pref_tc_gps&&
navigator.geolocation?(setTimeout(function(){d||f()},1E4),sp.showSuccess(_s("Getting Coordinates")),navigator.geolocation.getCurrentPosition(function(a){"function"!=typeof a&&(d=!0,c.latitude=a.coords.latitude,c.longitude=a.coords.longitude,setTimeout(e,2E3))},f)):e()});$("#tc_ov_way").bind(clickEvent,function(a){a.preventDefault();spModel.timeclock.create("preclockin",{employee:sp.staff.admin.info.id},function(a){$("#tc_ov_way_msg .sc_way_time_since").html(a.data.formatted);$("#tc_ov_way_msg").show();
$("#tc_ov_way").hide();$("#tc_ov_ci").show()})});$("#tc_ov_co").bind(clickEvent,function(a){a.preventDefault();var c={},a=$.trim($("#tc_ov_no").val());0!=$("#tc_ov_ss").val()&&(c.schedule=$("#tc_ov_ss").val());var d=!1,e=function(){spModel.timeclock.get("clockout",c,function(){$("#tc_ov_cb span.fr a").hide();$("#tc_ov_cf").hide();"1"==sp.staff.admin.business.pref_pre_time_clock&&($("#tc_ov_way").show(),$("#tc_ov_ci").show());"1"==sp.staff.admin.business.pref_mandatory_pre_time_clock&&($("#tc_ov_way").show(),
$("#tc_ov_ci").hide())})},f=function(){d=!0;sp.showError(_s("Coordinates not available"));setTimeout(function(){e()},2E3)};if(sp.staff.admin.business.pref_tc_require_pos&&0==$("#tc_ov_ss").val())return sp.showError(_s("Please choose schedule first")),!1;0!=a.length&&(c.notes=$("#tc_ov_no").val());if(sp.staff.admin.business.pref_tc_require_notes&&0==a.length)return sp.showError(_s("Please provide some notes")),!1;"1"==sp.staff.admin.business.pref_tc_gps&&navigator.geolocation?(setTimeout(function(){d||
f()},1E4),sp.showSuccess(_s("Getting Coordinates")),navigator.geolocation.getCurrentPosition(function(a){"function"!=typeof a&&(d=!0,c.latitude=a.coords.latitude,c.longitude=a.coords.longitude,setTimeout(e,2E3))},f)):e()});$("#tc_ov_ss").bind("change",function(){a.saveClockInChanges()});$("#tc_ov_sa").bind(clickEvent,function(b){b.preventDefault();a.saveClockInChanges()});$("#tc_ov_ca").bind(clickEvent,function(a){a.preventDefault();spModel.timeclock.dtc($(this).attr("rel"),function(){$("#tc_ov_cb span.fr a").hide();
$("#tc_ov_cf").hide();"1"==sp.staff.admin.business.pref_pre_time_clock&&($("#tc_ov_way").show(),$("#tc_ov_ci").show());"1"==sp.staff.admin.business.pref_mandatory_pre_time_clock&&($("#tc_ov_way").show(),$("#tc_ov_ci").hide())})})};
ShiftPlanningTimeClock.prototype.manageTimeSheetsEvents=function(){var a=this;$("#tc_mts_adv").bind(clickEvent,function(a){a.preventDefault();$("#tc_mts_hiin").hasClass("hidden")?$(this).html("Simple"):$(this).html("Advanced");$("#tc_mts_hiin").toggleClass("hidden")});$("#tc_mts_tr").bind("change",function(){"-1"!=$(this).val()&&a.getTimeSheets()});$("#tc_mts_sh").delegate("li",clickEvent,function(b){"tPending"!=b.target.className&&($(this).addClass("loading"),spModel.timeclock.get("timeclock",{id:$(this).attr("timeclockId")},
function(b){a.current=b.data;sp.loadSubPage("","timeClock","displayTimeClock")}))});$("#timeClock .displayTimeClock .backMenu").bind(clickEvent,function(a){a.preventDefault();$(".subNavigation .timeClock li.active a").trigger(clickEvent)});$("#tc_mts_hiin select, #tc_mts_au").bind("change",function(){a.showHideTimeSheets()});$("#tc_dtc_buttons a").bind(clickEvent,function(b){b.preventDefault();b=$(this).attr("rel");switch($(this).attr("class")){case "approve":spModel.timeclock.update("timeclock",
{id:b,approved:1},function(){sp.showSuccess(_s("Timeclock updated"));$(".subNavigation .timeClock li.active a").trigger(clickEvent)});break;case "unapprove":spModel.timeclock.update("timeclock",{id:b,approved:0},function(){sp.showSuccess(_s("Timeclock updated"));$(".subNavigation .timeClock li.active a").trigger(clickEvent)});break;case "edit":a.edit=!0;$("#tc_act_onci").hide();sp.loadSubPage("","timeClock","addClockTime");break;case "delete":confirm(_s("Are you sure?"))&&spModel.timeclock.del("timeclock",
{id:b},function(){$(".subNavigation .timeClock li.active a").trigger(clickEvent)})}});$("#tc_mts_sh").delegate("li span.tPending",clickEvent,function(){$(this).parent("li").addClass("loading");spModel.timeclock.get("clockout",{employee:$(this).attr("user")},function(){sp.showSuccess(_s("User clocked out"));a.getTimeSheets()})})};
ShiftPlanningTimeClock.prototype.addClockTimeEvents=function(){var a=this;$("#tc_act_onci").bind(clickEvent,function(){$(this).toggleClass("check");$("#tc_act .detailsGrid .odd").toggleClass("nonVisible")});$("#tc_act_sa_b").bind(clickEvent,function(b){b.preventDefault();a.saveClockTime(!1)})};
ShiftPlanningTimeClock.prototype.displayTimeSheetsEvents=function(){var a=this;$("#tc_dts_au").bind("change",function(){a.showHideTimeSheetsPro()});$("#tc_dts_tr").bind("change",function(){"-1"!=$(this).val()&&a.getMyTimeSheets()})};ShiftPlanningTimeClock.prototype.displayTimeSheetsSubEvents=function(){$("#tc_dts_tr").html(spView.timeRanges());$("#tc_dts_tr").val(3);this.getMyTimeSheets()};
ShiftPlanningTimeClock.prototype.overviewSubEvents=function(){$("#tc_ov_cf").hide();$("#tc_ov_cb span.fr a").hide();$("#tc_ov_ss").html(spView.optionSchedules(sp.staff.admin.info.id));$("#tc_ov_cb .icoClock").html('<time style="height:35px;display:block;">'+sp.raw.config.today.formatted+"</time>");$.ajax({url:"index.php?timezone=false&id="+sp.staff.admin.info.id,type:"get",success:function(a){$("#tc_ov_cb .icoClock").html(a)}});0==parseInt(sp.staff.admin.settings.tc_terminal_lock)?($("#tc_ov_cb").show(),
$("#tc_ov_ad").hide(),spModel.timeclock.get("status",{details:1},function(a){$("#tc_ov_cb span.fr a").hide();"out"!=a.data?($("#tc_ov_cf").show(),$("#tc_ov_co").show(),$("#tc_ov_ca").attr("rel",a.data.id),null!=a.data.schedule&&$("#tc_ov_ss").val(a.data.schedule.id),null!=a.data.notes&&$("#tc_ov_no").val(a.data.notes)):($("#tc_ov_cf").hide(),spModel.timeclock.get("preclockin",{employee:sp.staff.admin.info.id},function(a){"0"==a.data.status?($("#tc_ov_way_msg .sc_way_time_since").html(a.data.formatted),
$("#tc_ov_way_msg").show(),$("#tc_ov_ci").show()):("1"==sp.staff.admin.business.pref_pre_time_clock&&($("#tc_ov_way").show(),$("#tc_ov_ci").show()),"1"==sp.staff.admin.business.pref_mandatory_pre_time_clock&&($("#tc_ov_way").show(),$("#tc_ov_ci").hide()))}))})):($("#tc_ov_cb").hide(),$("#tc_ov_cf").hide(),$("#tc_ov_ad").show());$("#tc_ov_cb .icoClock time").html(sp.raw.config.today.formatted);$("#tc_ov_cb .icoClock span").html(formatted("nowT"))};
ShiftPlanningTimeClock.prototype.manageTimeSheetsSubEvents=function(){var a=this,b=Date.parse("today at 9am"),c=Date.parse("today at 5pm");$("#tc_mts_sd_i").scroller("destroy");$("#tc_mts_sd_i").val(b.toString(cal.dformat));$("#tc_mts_sd_i").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],
cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat),onSelect:function(){$("#tc_mts_tr").val(-1);a.getTimeSheets()}});$("#tc_mts_ed_i").scroller("destroy");$("#tc_mts_ed_i").val(c.toString(cal.dformat));$("#tc_mts_ed_i").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM",
"yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat),onSelect:function(){$("#tc_mts_tr").val(-1);a.getTimeSheets()}});$("#tc_mts_tr").html(spView.timeRanges());$("#tc_mts_tr").val(3);$("#tc_mts_scl").html(spView.scheduleFilter(0,!0));$("#tc_mts_eml").html(spView.staffFilter());a.getTimeSheets()};
ShiftPlanningTimeClock.prototype.addClockTimeSubEvents=function(){var a={};!1!=this.edit?(a=this.current,$("#tc_act .title h3").html(_s("Edit Clock Time")),$("#tc_act_tc_id").removeClass("editOn").addClass("editOn"),$("#tc_act_tc_id").val(a.id),$(".addClockTime .odd").removeClass("nonVisible"),$("#tc_act_onci").removeClass("check"),a.in_time.time=sp.strReplace(["am","pm"],[" AM"," PM"],a.in_time.time),a.out_time.time=sp.strReplace(["am","pm"],[" AM"," PM"],a.out_time.time),a.in_time.day=Date.parse(a.in_time.day).toString(cal.dformat),
a.out_time.day=Date.parse(a.out_time.day).toString(cal.dformat)):($("#tc_act .title h3").html(_s("Add Clock Time")),$("#tc_act_tc_id").removeClass("editOn"),$("#tc_act_onci").show(),a.in_timestamp=Date.parse("today at 9am").getTime()/1E3,a.out_timestamp=Date.parse("today at 5pm").getTime()/1E3);$("#tc_act_sc").html(spView.optionSchedules(4<sp.staff.admin.info.group?sp.staff.admin.info.id:0));$("#tc_act_em").html(spView.staffOption(4<sp.staff.admin.info.group?!0:!1));var b=new Date(1E3*a.in_timestamp),
c=new Date(1E3*a.out_timestamp),d=24==cal.tmode?"HH:mm":"hh:mm tt";$("#tc_act_tclin").scroller("destroy");$("#tc_act_tclin").val(this.edit?a.in_time.time:b.toString(d));$("#tc_act_tclin").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt","mm"],["A","ii"],cal.tstring)});$("#tc_act_tclou").scroller("destroy");$("#tc_act_tclou").val(this.edit?a.out_time.time:c.toString(d));$("#tc_act_tclou").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt",
"mm"],["A","ii"],cal.tstring)});$("#tc_act_c_cl_dp_i").scroller("destroy");$("#tc_act_c_cl_dp_i").val(this.edit?a.in_time.day:b.toString(cal.dformat));$("#tc_act_c_cl_dp_i").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],
["mm","yy","","",""],cal.dformat)});$("#tc_act_c_co_dp_i").scroller("destroy");$("#tc_act_c_co_dp_i").val(this.edit?a.out_time.day:c.toString(cal.dformat));$("#tc_act_c_co_dp_i").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-",
"/"],["mm","yy","","",""],cal.dformat)});$("#tc_act_no").val(this.edit?a.notes:"");$("#tc_act_em").val(this.edit?a.employee.id:0);$("#tc_act_sc").val(this.edit?null!=a.schedule?a.schedule.id:0:0);this.edit=!1};
ShiftPlanningTimeClock.prototype.displayTimeClockSubEvents=function(){this.current.employee.avatar=sp.getAvatar(this.current.employee.id);$("#tc_dtc").html($.tmpl($("#te_tc_dtc"),this.current));$("#tc_dtc_buttons a").attr("rel",this.current.id);0!=parseInt(this.current.approved_by)?$("#tc_dtc_buttons a#tc_dtc_ap").removeClass("approve").removeClass("unapprove").addClass("unapprove"):$("#tc_dtc_buttons a#tc_dtc_ap").removeClass("approve").removeClass("unapprove").addClass("approve")};
ShiftPlanningTimeClock.prototype.getTimeSheets=function(){$("#tc_mts_sh").html(spView.divLoader());var a=this,b={},c=$("#tc_mts_tr").val(),d={},d="-1"!=c?spRanges.getRange("times",c):{start_time:Date.parse($("#tc_mts_sd_i").val()).getTime(),end_time:Date.parse($("#tc_mts_ed_i").val()).getTime()},c=new Date(d.start_time),d=new Date(d.end_time);$("#tc_mts_sd_i").val(c.toString(cal.dformat));$("#tc_mts_ed_i").val(d.toString(cal.dformat));b.start_date=c.toString(cal.dformat);b.end_date=d.toString(cal.dformat);
spModel.timeclock.get("timeclocks",b,function(b){a.renderManageTimeSheets(b.data)})};
ShiftPlanningTimeClock.prototype.getMyTimeSheets=function(){$("#tc_dts_ul").html(spView.ulLoader());var a=this,b=$("#tc_dts_tr").val(),c={},d={},c=spRanges.getRange("times",b),b=new Date(c.end_time);d.start_date=(new Date(c.start_time)).toString(cal.dformat);d.end_date=b.toString(cal.dformat);d.employee=sp.staff.admin.info.id;spModel.timeclock.get("timeclocks",d,function(b){$("#tc_dts_ul").html($.tmpl($("#te_tc_dts_li"),b.data));a.showHideTimeSheetsPro()})};
ShiftPlanningTimeClock.prototype.renderManageTimeSheets=function(a){for(var b=a.length,c={};b--;){var d=a[b],e=Date.parse(d.in_time.day).getTime()/1E3+"";"undefined"==typeof c[e]&&(c[e]={month:d.in_time.day,rest:[],ident:parseInt(e)});d=this.rItem(d);c[e].rest.push(d)}$.each(c,function(a){c[a].rest.reverse()});var f=[],g=0;$.each(c,function(a,b){f[g]=b;g++});f.objSort("ident");f.reverse();$("#tc_mts_sh").html("");$("#tc_mts_sh").html($.tmpl($("#te_tc_mts_li"),f));this.showHideTimeSheets()};
ShiftPlanningTimeClock.prototype.rItem=function(a){var b={},b=2;0<parseInt(a.approved_by)&&(b=1);return b={id:a.id,name:a.employee.name,user:a.employee.id,st:a.in_time,out:a.out_time,dl:a.in_location==a.out_location?"0":"1",length:a.length,schedule:null!=a.schedule&&"undefined"!=typeof a.schedule.id?a.schedule.id:a.schedule,scn:null!=a.schedule&&"undefined"!=typeof a.schedule.name?a.schedule.name:"",status:b,approved_by:a.approved_by}};
ShiftPlanningTimeClock.prototype.showHideTimeSheetsPro=function(){switch($("#tc_dts_au").val()){case "2":$("#tc_dts_ul li").hide();$("#tc_dts_ul").find("li.app_0").show();break;case "1":$("#tc_dts_ul li").show();$("#tc_dts_ul").find("li.app_0").hide();break;case "0":$("#tc_dts_ul li").show()}0==$("#tc_dts_ul li:visible").length?$("#tc_dts_ul_msg").html(spView.emptyResult("No timesheets for selected filters")):$("#tc_dts_ul_msg").html("")};
ShiftPlanningTimeClock.prototype.showHideTimeSheets=function(){var a=parseInt($("#tc_mts_au").val()),b=parseInt($("#tc_mts_eml").val()),c=parseInt($("#tc_mts_scl").val()),d="";0!=a&&(d+=".s_"+a);0!=b&&(d+=".e_"+b);0!=c&&(d+=".sc_"+c);$("#tc_mts_sh").find("li").hide();$("#tc_mts_sh").find("li"+d).show();$("#tc_mts_sh div.title").hide();$("#tc_mts_sh ul li:visible").parents(".timeSheet").prev().show();0<$("#tc_mts_sh ul li:visible").length?$("#tc_mts_sh").next().hide():$("#tc_mts_sh").next().show()};
ShiftPlanningTimeClock.prototype.saveClockInChanges=function(){var a={id:$("#tc_ov_ca").attr("rel")};0!=$("#tc_ov_ss").val()&&(a.schedule=$("#tc_ov_ss").val());0!=$("#tc_ov_no").val()&&(a.notes=$("#tc_ov_no").val());spModel.timeclock.update("timeclock",a,function(){sp.showSuccess(_s("Timeclock updated"))})};
ShiftPlanningTimeClock.prototype.saveClockTime=function(){var a={},b="get",c="timeclock.addclocktime",d=_s("Clock Time added");!0==$("#tc_act_tc_id").hasClass("editOn")?(b="update",c="timeclock.timeclock",a.id=$("#tc_act_tc_id").val(),d=_s("Clock time edited"),a.start_date=$("#tc_act_c_cl_dp_i").val()+" "+$("#tc_act_tclin").val(),a.start_time=$("#tc_act_c_cl_dp_i").val()+" "+$("#tc_act_tclin").val(),a.end_date=$("#tc_act_c_co_dp_i").val()+" "+$("#tc_act_tclou").val(),a.end_time=$("#tc_act_c_co_dp_i").val()+
" "+$("#tc_act_tclou").val()):(a.datein=$("#tc_act_c_cl_dp_i").val()+" "+$("#tc_act_tclin").val(),a.dateout=$("#tc_act_c_co_dp_i").val()+" "+$("#tc_act_tclou").val());a.schedule=$("#tc_act_sc").val();a.employee=$("#tc_act_em").val();$("#tc_act_onci").hasClass("check")&&(a.onlyin=1);a.notes=$("#tc_act_no").val();sp.api(c,b,a,function(){sp.showSuccess(d);setTimeout(function(){var a="displayTimeSheets";2>=sp.staff.admin.info.group&&(a="manageTimeSheets");$(".subNavigation div.timeClock ul.timeClock a[subpage="+
a+"]").trigger(clickEvent)},400)},function(a){sp.showError(a.error)})};ShiftPlanningTimeClock.prototype.loadPage=function(){};ShiftPlanningReports.prototype.initialize=function(){var a=this;this.reports=[];$(document).ready(function(){a.allReportsEvents();user.loggedIn&&a.allReportsSubEvents()})};
ShiftPlanningReports.prototype.allReportsEvents=function(){var a=this;$("#reports .advancedButton").bind(clickEvent,function(a){a.preventDefault();$(this).hasClass("advancedOpened")?($(this).removeClass("advancedOpened"),$(this).html("Advanced")):($(this).addClass("advancedOpened"),$(this).html("Simple"));$(this).parents(".main").find("li.advancedMenu").toggleClass("hidden")});$("#reports .timeSelector").bind("change",function(){var b=$(this).val();if("-1"!=b&&"99"!=b){var c=spRanges.getRange("times",
b),b=new Date(c.start_time),c=new Date(c.end_time);$("#reports ."+a.page+" .timeFromSelector").val(b.toString(cal.dformat));$("#reports ."+a.page+" .timeToSelector").val(c.toString(cal.dformat));a.displayReports()}});$("#reports .checkbox").bind(clickEvent,function(){$(this).toggleClass("check");a.displayReports()});$("#reports .employeeSelector, #reports .advancedMenu select").bind("change",function(){a.displayReports()});$("#reports .listReports").delegate("a.fr",clickEvent,function(b){b.preventDefault();
a.cId=$(this).attr("rel");sp.loadSubPage("","reports","singleViewDisplay")});$("#re_si_inf").bind(clickEvent,function(a){a.preventDefault();$("#wrapper > .subNavigation").show();$("#wrapper > .subNavigation .reports li.active a").trigger(clickEvent)})};
ShiftPlanningReports.prototype.allReportsSubEvents=function(){var a=this;spView.fixCurrency(sp.staff.admin.settings.currency);$("#reports .timeSelector").html(spView.timeRanges());$("#reports .timeSelector").val(3);$("#reports .employeeSelector").html(spView.staffFilter());$("#reports .positionsSelector").html(spView.scheduleFilter());$("#reports .skillsSelector").html(spView.skillsFilter());var b=spRanges.getRange("times",$("#reports .timeSelector").first().val()),c=new Date(b.start_time),b=new Date(b.end_time);
$("#reports .timeFromSelector").scroller("destroy");$("#reports .timeFromSelector").val(c.toString(cal.dformat));$("#reports .timeFromSelector").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat),
onSelect:function(){$("#reports ."+a.page+" .timeSelector").val(-1);a.displayReports()}});$("#reports .timeToSelector").scroller("destroy");$("#reports .timeToSelector").val(b.toString(cal.dformat));$("#reports .timeToSelector").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),
dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat),onSelect:function(){$("#reports ."+a.page+" .timeSelector").val(-1);a.displayReports()}})};
ShiftPlanningReports.prototype.displayReports=function(){if("singleViewDisplay"==this.page)return!1;sp.globalLoader();var a=this,b=this.page,c=this.page;$("#reports ."+c+" .totals").hide();$("#reports ."+c+" .noResults").hide();$("#reports ."+c+" .notif").hide();$("#reports ."+c+" .listReports").html(spView.ulLoader());var d={type:b.toLowerCase()};"confirmedTimeSheets"==b&&(d.type="timesheets");d.start_date=$("#reports ."+c+" .timeFromSelector").val();d.end_date=$("#reports ."+c+" .timeToSelector").val();
$("#reports ."+c+" time.from").html($("#reports ."+c+" .timeFromSelector").val());$("#reports ."+c+" time.to").html($("#reports ."+c+" .timeToSelector").val());d.schedule=$("#reports ."+c+" .positionsSelector").val();d.employee=$("#reports ."+c+" .employeeSelector").val();d.skill=$("#reports ."+c+" .skillsSelector").val();d.deduct_breaks=$("#reports ."+c+" .re_deductBreaks").hasClass("check")?1:0;d.group_results=$("#reports ."+c+" .re_groupResults").hasClass("check")?1:0;d.show_empty=$("#reports ."+
c+" .re_showEmpty").hasClass("check")?1:0;spModel.payroll.get("report",d,function(b){0==b.data.length?($("#reports ."+c+" .totals").hide(),$("#reports ."+c+" .notif").show()):$("#reports ."+c+" .totals").show();var d=0,g=0,j=0,i=0,h=0,m=[];$.each(b.data,function(a,b){d+=Number(b.hours.regular);g+=Number(b.hours.special);j+=Number(b.hours.overtime);i+=Number(b.hours.total);h+=Number(b.hours.cost);m[a]=b;m[a].avatar="undefined"!=typeof sp.staff.data.employees[b.userid]&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&
""!=sp.staff.data.employees[b.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";m[a].rId=a});a.reports=m;$("#reports ."+c+" .listReports").html($.tmpl($("#te_re_info"),m));$("#reports ."+c+" .TSregular > span > span").html(d.toFixed(2));$("#reports ."+c+" .TSspecial > span > span").html(g.toFixed(2));$("#reports ."+c+" .TSovertime > span > span").html(j.toFixed(2));$("#reports ."+c+" .TStotal > span > span").html(i.toFixed(2)+
" Hours");$("#reports ."+c+" .TScost > span > span:not(.currency)").html(h.toFixed(2))})};ShiftPlanningReports.prototype.singleViewDisplay=function(a){$("#wrapper > .subNavigation").hide();try{var b=this.reports[a];$("#re_di_item").html($.tmpl($("#te_re_"+this.page+"_"+($("#reports ."+this.page+" .re_groupResults").hasClass("check")?"1":"0")),b));spView.fixCurrency(sp.staff.admin.settings.currency)}catch(c){console.log("Greska"),console.log(c)}};
ShiftPlanningReports.prototype.loadSubPageEvents=function(a){if("singleViewDisplay"==a)this.singleViewDisplay(this.cId);else{this.allReportsSubEvents();var b=this,a=this.page=a;$("#reports ."+a+" .totals").hide();$("#reports ."+a+" .noResults").hide();$("#reports ."+a+" .notif").hide();$("#reports ."+a+" .listReports").html(spView.ulLoader());setTimeout(function(){b.displayReports()},100)}};ShiftPlanningReports.prototype.loadPage=function(){};
ShiftPlanningRequests.prototype.initialize=function(){var a=this;$(document).ready(function(){a.overviewEvents();a.vacationEvents();a.availableEvents();a.openShiftsEvents();a.shiftTradesEvents();a.shiftApprovalsEvents()})};
ShiftPlanningRequests.prototype.loadSubPageEvents=function(a){$(".subNavigation").show();switch(a){case "overview":this.overviewSubEvents();break;case "vacation":this.vacationSubEvents();break;case "available":this.availableSubEvents();break;case "shiftTrades":this.shiftTradesSubEvents();break;case "shiftApprovals":this.shiftApprovalsSubEvents();break;case "openShifts":this.openShiftsSubEvents();break;case "vacationRequestManage":$(".subNavigation").hide();this.displayVacationRequest();break;case "shiftTradeManager":$(".subNavigation").hide();
this.displayShiftTradeManager();break;case "shiftTradeManagerAP":$(".subNavigation").hide();this.displayShiftTradeManagerAP();break;case "shiftSwapRequest":$(".subNavigation").hide();this.shiftSwapRequestSubEvents();break;case "shiftTradeManagerIM":$(".subNavigation").hide();this.displayShiftTradeManagerIM();break;case "openShiftsOpen":$(".subNavigation").hide();this.displayOpenShifts();break;case "openShiftsRequest":$(".subNavigation").hide();this.displayOpenRequests();break;case "shiftApprovalsSingle":$(".subNavigation").hide(),
this.shiftApprovalsSingle()}};ShiftPlanningRequests.prototype.overviewEvents=function(){$("#requests #rq_ov a").bind(clickEvent,function(a){a.preventDefault();$(".subNavigation .requests li a[subpage="+$(this).attr("subpage")+"]").trigger(clickEvent)});$("#requests .backMenu").bind(clickEvent,function(a){a.preventDefault();$(".subNavigation .requests li a[subpage="+$(this).attr("subpage")+"]").trigger(clickEvent)})};
ShiftPlanningRequests.prototype.vacationEvents=function(){var a=this;$("#requests #rq_va");$("#rq_va table");$("#rq_va_sr").bind(clickEvent,function(b){b.preventDefault();$(this).addClass("loading");a.addVacationRequest($(this))});$("#rq_va_fr").scroller();$("#rq_va_to").scroller();$("#rq_va_rq").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.vacations[$(this).attr("rel")];sp.loadSubPage("","requests","vacationRequestManage")});$("#rq_va_ma_acp").bind(clickEvent,function(b){b.preventDefault();
$(this).addClass("loading");a.approveVacationRequest($(this))});$("#rq_va_ma_dec").bind(clickEvent,function(b){b.preventDefault();$(this).addClass("loading");a.declineVacationRequest($(this))});$("#rq_va_spd").bind(clickEvent,function(a){a.preventDefault();$("#rq_va_up .pastDate").toggleClass("hidden");"Show past dates"==$("#rq_va_spd").html()?$("#rq_va_spd").html("Hide past dates"):"Hide past dates"==$("#rq_va_spd").html()&&$("#rq_va_spd").html("Show past dates")});$("#rq_va").delegate("a.deleteVacation",
clickEvent,function(b){b.preventDefault();a.cancelVacationRequest($(this).attr("rel"))})};
ShiftPlanningRequests.prototype.availableEvents=function(){var a=this;$("#rq_av_pu").bind(clickEvent,function(a){a.preventDefault();sp.loadSubPage("","requests","openShifts")});$("#rq_av_sw, #rq_av_tr").bind(clickEvent,function(a){a.preventDefault();sp.loadSubPage("","requests","shiftTrades")});$("#rq_av_pu_li").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.available.pickup[$(this).attr("rel")];sp.loadSubPage("","requests","openShiftsOpen")});$("#rq_av_sw_li").delegate("a",clickEvent,
function(b){b.preventDefault();a.current=a.available.swap[$(this).attr("rel")];sp.loadSubPage("","requests","shiftSwapRequest")});$("#rq_av_tr_li").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.available.trade[$(this).attr("rel")];sp.loadSubPage("","requests","shiftTradeManagerAP")})};
ShiftPlanningRequests.prototype.openShiftsEvents=function(){var a=this;$("#rq_os_os").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.shifts[$(this).attr("rel")];sp.loadSubPage("","requests","openShiftsOpen")});$("#rq_os_spr").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.shiftsR[$(this).attr("rel")];sp.loadSubPage("","requests","openShiftsRequest")});$("#rq_os_os_s").delegate("#rq_os_rtw.green",clickEvent,function(a){a.preventDefault();var c=$(this);c.addClass("loading");
spModel.schedule.create("shiftrequests",{shift:$(this).attr("rel")},function(){c.removeClass("loading").removeClass("green").addClass("grey").html(_s("<span>Cancel pending request</span>"))})});$("#rq_os_os_s").delegate("#rq_os_rtw.grey",clickEvent,function(a){a.preventDefault();var c=$(this);c.addClass("loading");spModel.schedule.update("shift",{id:$(this).attr("rel"),remove:sp.staff.admin.info.id},function(){c.removeClass("loading").removeClass("grey").removeClass("green").html(_s("Request Removed"))})});
$("#rq_os_spr_s").delegate(".step a",clickEvent,function(a){a.preventDefault();var c=$(this);c.addClass("loading");a={id:$(this).attr("rel"),type:"openshifts"};a.mode=$(this).hasClass("accept")?"approve":"reject";spModel.schedule.update("requests",a,function(){c.removeClass("loading");$(".subNavigation .requests li a[subpage=openShifts]").trigger(clickEvent)},function(){c.removeClass("loading")})})};
ShiftPlanningRequests.prototype.shiftTradesEvents=function(){var a=this;$("#rq_st_mst").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.trades.manage[$(this).attr("rel")];sp.loadSubPage("","requests","shiftTradeManager")});$("#rq_st_ap").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.trades.avaiting[$(this).attr("rel")];sp.loadSubPage("","requests","shiftTradeManagerAP")});$("#rq_st_im").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.trades.requested[$(this).attr("rel")];
sp.loadSubPage("","requests","shiftTradeManagerIM")});$("#rq_st_swap").delegate("a",clickEvent,function(b){b.preventDefault();a.current=a.swaps[$(this).attr("rel")];sp.loadSubPage("","requests","shiftSwapRequest")});$("#rq_st_sh_swap").delegate(".traders a",clickEvent,function(){var a=$(this).attr("swapId"),c=$(this).attr("shiftId"),d=$(this).attr("class"),e=$(this);e.addClass("loading");var f="accept"==d?"You have accepted this shift trade.":"You have rejected this shift trade.";spModel.schedule.update("tradeswap",
{shift_for_swap:c,trade:a,action:d},function(){e.removeClass("loading");sp.showSuccess(f);$(".subNavigation .requests li a[subpage=shiftTrades]").trigger(clickEvent)})});$("#rq_st_mst_s").delegate(".traders a",clickEvent,function(a){var c=$(this);c.addClass("loading");a.preventDefault();var a=$(this).attr("tradeId"),d=$(this).attr("userId"),a={trade:a,user:d};a.action=$(this).hasClass("accept")?"accept":"reject";spModel.schedule.update("trade",a,function(){c.removeClass("loading");$(".subNavigation .requests li a[subpage=shiftTrades]").trigger(clickEvent)},
function(a){sp.showError(a.error)})});$("#rq_st_mts_sub ul a").bind(clickEvent,function(a){a.preventDefault();var c=$(this),d={trade:$(this).attr("rel")};$(this).hasClass("activate")&&(d.action="activate");if($(this).hasClass("cancel")&&(d.action="cancel",!confirm(_s("Are you sure you want to cancel this request?"))))return c.removeClass("loading"),!1;$(this).hasClass("deactivate")&&(d.action="deactivate");c.addClass("loading");spModel.schedule.update("trade",d,function(){c.removeClass("loading");
"activate"==d.action?sp.showSuccess(_s("Shift trade accepted, waiting for potentional acceptors to accept.")):"deactivate"==d.action?sp.showSuccess(_s("Shift trade rejected.")):sp.showSuccess(_s("Shift trade canceled."));$(".subNavigation .requests li a[subpage=shiftTrades]").trigger(clickEvent)},function(a){sp.showError(a.error)})});$("#rq_st_ap_sub ul a").bind(clickEvent,function(a){var c=$(this);c.addClass("loading");a.preventDefault();var d={trade:$(this).attr("rel")};d.action=$(this).hasClass("accept")?
"accept":"reject";spModel.schedule.update("trade",d,function(){c.removeClass("loading");sp.showSuccess(i18n.format(_s("Shift trade pick up {action}"),{action:d.action}));$(".subNavigation .requests li a[subpage=shiftTrades]").trigger(clickEvent)},function(a){sp.showError(a.error)})});$("#rq_st_im_sm a").bind(clickEvent,function(a){a.preventDefault();var c=$(this);c.addClass("loading");a={trade:$(this).attr("rel")};if($(this).hasClass("cancel")){if(!confirm(_s("Are you sure you want to cancel this request?")))return c.removeClass("loading"),
!1;a.action="cancel"}spModel.schedule.update("trade",a,function(){c.removeClass("loading");$(".subNavigation .requests li a[subpage=shiftTrades]").trigger(clickEvent)})})};
ShiftPlanningRequests.prototype.shiftApprovalsEvents=function(){var a=this;$("#rq_sa select").bind("change",function(){a.shiftApproveList()});$("#rq_sa_ho").delegate(".checkbox",clickEvent,function(){var b=$(this);if(!b.hasClass("check")){var c=b.attr("shiftId");spModel.schedule.update("shiftapprove",{id:c},function(d){b.addClass("check");a.addShift(c,d.data)},function(a){sp.showError(a.error)})}});$("#rq_sa_ho").delegate("span.names, span.time",clickEvent,function(){var b=$(this).parent();b.addClass("loading");
var c=b.find(".checkbox").attr("shiftId");b.find(".checkbox").hasClass("check")?spModel.schedule.get("shiftapprove",{id:c},function(b){var e=a.getShift(c);null!=e.employees&&$.each(b.data,function(a,b){$.each(e.employees,function(a,c){c.id==b.employee&&(e.employees[a].shift=b)})});a.current=a.fixShiftsApproval(e);sp.loadSubPage("","requests","shiftApprovalsSingle")},function(a){b.removeClass("loading");sp.showError(a.data)}):spModel.schedule.update("shiftapprove",{id:c},function(d){b.find(".checkbox").addClass("check");
a.addShift(c,d.data);a.current=a.fixShiftsApproval(d.data);sp.loadSubPage("","requests","shiftApprovalsSingle")},function(a){b.removeClass("loading");sp.showError(a.data)})});$("#rq_sa_s").delegate(".checkbox",clickEvent,function(){$(this).toggleClass("check")});$("#rq_sa_sub .approve").bind(clickEvent,function(b){b.preventDefault();a.saveShiftApprove()})};
ShiftPlanningRequests.prototype.overviewSubEvents=function(){$("#rq_ov_loader").show();$("#rq_ov_widgets").hide();$("#rq_ov_hd").hide();$("#rq_ov_loader").html(spView.ulLoader());spModel.admin.get("nrequests",{},function(a){"undefined"==typeof a.data.vacation&&(a.data.vacation=0);"undefined"==typeof a.data.shift_approval&&(a.data.shift_approval=0);"undefined"==typeof a.data.shift_request_waiting&&(a.data.shift_request_waiting=0);"undefined"==typeof a.data.trade_approval&&(a.data.trade_approval=0);
"undefined"==typeof a.data.trade_approval&&(a.data.trade_approval=0);"undefined"==typeof a.data.shift_available&&(a.data.shift_available=0);0==a.data.vacation?$("#rq_rl_va").hide():$("#rq_rl_va").show();0==a.data.shift_approval?$("#rq_rl_sp").hide():$("#rq_rl_sp").show();0==a.data.shift_request_waiting?$("#rq_rl_sr").hide():$("#rq_rl_sr").show();0==a.data.trade_approval?$("#rq_rl_ast").hide():$("#rq_rl_ast").show();0==a.data.shift_available?$("#rq_rl_sv").hide():$("#rq_rl_sv").show();$("#rq_rl_va .icon b").html(a.data.vacation);
$("#rq_rl_sp .icon b").html(a.data.shift_approval);$("#rq_rl_sr .icon b").html(a.data.shift_request_waiting);$("#rq_rl_ast .icon b").html(a.data.trade_approval);$("#rq_rl_sv .icon b").html(a.data.shift_available);$("#rq_ov_widgets").show();$("#rq_ov .widgets li:visible").attr("style","");$("#rq_ov .widgets li:visible:first").css("border-top","none");0==$("#rq_ov .widgets li:visible").length?($("#rq_ov_hd").show(),$("#rq_ov_widgets").hide()):$("#rq_ov_hd").hide();$("#rq_ov_loader").hide()},function(a){sp.showError(a.error)})};
ShiftPlanningRequests.prototype.vacationSubEvents=function(){var a=this;$("#rq_va_wc").val("");$("#rq_va_fr").val("");$("#rq_va_to").val("");1==sp.staff.admin.settings.book_days_off?($("#rq_va .newMsg").show(),$("#rq_va .newMsg").next().show()):($("#rq_va .newMsg").hide(),$("#rq_va .newMsg").next().hide());$("#rq_va_en").html(spView.staffOption(4>=sp.staff.admin.info.group?!1:!0));$("#rq_va_spd").hide();$("#rq_va_rq").html(spView.ulLoader());$("#rq_va_aa").html(spView.ulLoader());$("#rq_va_up").html(spView.ulLoader());
$("#rq_va_rq").show();$("#rq_va_aa").show();$("#rq_va_up").show();$("#rq_va_rq").next().hide();$("#rq_va_aa").next().hide();$("#rq_va_up").next().hide();$("#rq_va_ma_acp, #rq_va_ma_dec").removeClass("loading");4>=sp.staff.admin.info.group?spModel.schedule.get("vacations",{mode:"manage"},function(b){if(0==b.data.length)$("#rq_va_rq").hide(),$("#rq_va_rq").next().show();else{$("#rq_va_rq").show();$("#rq_va_rq").next().hide();var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].avatar="undefined"!=typeof sp.staff.data.employees[b.userid]&&
"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&""!=sp.staff.data.employees[b.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";c[a].rId=a});a.vacations=c;$("#rq_va_rq").html($.tmpl($("#te_rq_va_ma"),c))}}):($("#rq_va_rq").hide(),$("#rq_va_rq").next().show());spModel.schedule.get("vacations",{mode:"requested"},function(a){0==a.data.length?($("#rq_va_aa").hide(),$("#rq_va_aa").next().show()):
($("#rq_va_aa").show(),$("#rq_va_aa").next().hide(),$("#rq_va_aa").html($.tmpl($("#te_rq_va_aa"),a.data)))},function(a){sp.showError(a.error)});spModel.schedule.get("vacations",{start_date:"last year",end_date:"next year"},function(b){b.data=a.clearVacations(b.data);0==b.data.length?($("#rq_va_up").hide(),$("#rq_va_up").next().show()):($("#rq_va_up").show(),$("#rq_va_up").next().hide(),$("#rq_va_up").html($.tmpl($("#te_rq_va_up"),b.data)),0<$("#rq_va_up .pastDate").length?$("#rq_va_spd").show():$("#rq_va_spd").hide())},
function(a){sp.showError(a.error)})};
ShiftPlanningRequests.prototype.availableSubEvents=function(){$("#rq_av_pu .icon b").html("");$("#rq_av_sw .icon b").html("");$("#rq_av_tr .icon b").html("");$("#rq_av_pu_li").html(spView.ulLoader());$("#rq_av_sw_li").html(spView.ulLoader());$("#rq_av_tr_li").html(spView.ulLoader());var a=this;sp.multiApi([["schedule.shifts","GET",{mode:"open"}],["schedule.trades","GET",{}],["schedule.trades","get",{mode:"swap"}]],function(b){a.available.pickup=sp.map(b[0].data);a.available.swap=sp.map(b[2].data);
a.available.trade=sp.map(b[1].data);$("#rq_av_pu .icon b").html(sp.countResponse(b[0].data));$("#rq_av_pu_li").html($.tmpl($("#te_da_all_shiftV2"),sp.objToArray(b[0].data)));0<sp.countResponse(b[0].data)?$("#rq_av_pu_li").show():$("#rq_av_pu_li").hide();$("#rq_av_sw .icon b").html(sp.countResponse(b[2].data));var c=[];$.each(b[2].data,function(a,b){b.avatar=sp.getAvatar(b.user);c.push(b)});0<sp.countResponse(b[2].data)?$("#rq_av_sw_li").show():$("#rq_av_sw_li").hide();$("#rq_av_sw_li").html($.tmpl($("#te_da_all_shiftV2"),
c));$("#rq_av_tr .icon b").html(sp.countResponse(b[1].data));0<sp.countResponse(b[1].data)?$("#rq_av_tr_li").show():$("#rq_av_tr_li").hide();$("#rq_av_tr_li").html($.tmpl($("#te_da_all_shiftV2"),sp.objToArray(b[1].data)))})};
ShiftPlanningRequests.prototype.openShiftsSubEvents=function(){var a=this;$("#rq_os_os").html(spView.ulLoader());$("#rq_os_os").next().hide();$("#rq_os_spr").prev().show();$("#rq_os_spr").html(spView.ulLoader());$("#rq_os_spr").next().hide();spModel.schedule.get("shifts",{mode:"open",detailed:1},function(b){if(0==b.data.length)$("#rq_os_os").hide(),$("#rq_os_os").next().show();else{$("#rq_os_os").show();$("#rq_os_os").next().hide();var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].rId=a});a.shifts=
c;$("#rq_os_os").html($.tmpl($("#te_da_all_shift"),b.data))}},function(a){sp.showError(a.error)});4>sp.staff.admin.info.group?spModel.schedule.get("shifts",{mode:"openapproval"},function(b){if(0==b.data.length)$("#rq_os_spr").hide(),$("#rq_os_spr").next().show();else{$("#rq_os_spr").show();$("#rq_os_spr").next().hide();b.data=a.prepareOpenShiftsNA(b.data);var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].avatar="undefined"!=typeof sp.staff.data.employees[b.userid]&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&
""!=sp.staff.data.employees[b.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";c[a].rId=a});a.shiftsR=c;$("#rq_os_spr").html($.tmpl($("#te_da_all_shift"),b.data))}},function(a){sp.showError(a.error)}):($("#rq_os_spr").prev().hide(),$("#rq_os_spr").hide(),$("#rq_os_spr").next().hide())};
ShiftPlanningRequests.prototype.shiftTradesSubEvents=function(){var a=this;$("#rq_st_mst").html(spView.ulLoader());$("#rq_st_ap").html(spView.ulLoader());$("#rq_st_swap").html(spView.ulLoader());$("#rq_st_im").html(spView.ulLoader());$("#rq_st_mst").show();$("#rq_st_ap").show();$("#rq_st_im").show();$("#rq_st_mst").next().hide();$("#rq_st_ap").next().hide();$("#rq_st_im").next().hide();$("#rq_st_swap").next().hide();4>=sp.staff.admin.info.group?spModel.schedule.get("trades",{mode:"manage"},function(b){if(0==
b.data.length)$("#rq_st_mst").hide(),$("#rq_st_mst").next().show();else{$("#rq_st_mst").show();$("#rq_st_mst").next().hide();var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].avatar="undefined"!=typeof sp.staff.data.employees[b.userid]&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&""!=sp.staff.data.employees[b.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";c[a].rId=a});a.trades.manage=
c;$("#rq_st_mst").html($.tmpl($("#te_rq_st_mst"),c))}},function(a){sp.showError(a.error)}):($("#rq_st_mst").hide(),$("#rq_st_mst").next().show());spModel.schedule.get("trades",{},function(b){if(0==b.data.length)$("#rq_st_ap").hide(),$("#rq_st_ap").next().show();else{$("#rq_st_ap").show();$("#rq_st_ap").next().hide();var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].avatar="undefined"!=typeof sp.staff.data.employees[b.userid]&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&""!=sp.staff.data.employees[b.userid].avatar&&
"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";c[a].rId=a});a.trades.avaiting=c;$("#rq_st_ap").html($.tmpl($("#te_rq_st_ap"),c))}},function(a){sp.showError(a.error)});spModel.schedule.get("trades",{mode:"requested"},function(b){if(0==b.data.length)$("#rq_st_im").hide(),$("#rq_st_im").next().show();else{$("#rq_st_im").show();$("#rq_st_im").next().hide();var c=[];$.each(b.data,function(a,b){c[a]=b;c[a].avatar=
"undefined"!=typeof sp.staff.data.employees[b.userid]&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar&&""!=sp.staff.data.employees[b.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[b.userid].avatar.small?sp.staff.data.employees[b.userid].avatar.small:"images/no-avatar.png";c[a].rId=a});a.trades.requested=c;$("#rq_st_im").html($.tmpl($("#te_rq_st_ap"),c))}},function(a){sp.showError(a.error)});spModel.schedule.get("trades",{mode:"swap"},function(b){if(""!=b.data){a.swaps=b.data;
var c=[];$("#rq_st_swap").show();$.each(b.data,function(a,b){b.avatar=sp.getAvatar(b.user);c.push(b)});$("#rq_st_swap").html($.tmpl($("#te_rq_swap_single"),c))}else $("#rq_st_swap").hide(),$("#rq_st_swap_empty").show()})};ShiftPlanningRequests.prototype.clearVacations=function(a){var b=[];if(0==a.length)return b;$.each(a,function(a,d){d.employee==sp.staff.admin.info.id&&b.push(d)});return b};
ShiftPlanningRequests.prototype.shiftApprovalsSubEvents=function(){$("#rq_sa_po").html(spView.scheduleFilter());$("#rq_sa_em").html(spView.staffFilter());$("#rq_sa_ho").html(spView.divLoader());this.shiftApproveList()};
ShiftPlanningRequests.prototype.shiftApproveList=function(){this.shifts=[];$("#rq_sa_ho").html(spView.divLoader());var a=this,b={mode:"confirm"};0!=$("#rq_sa_po").val()&&(b.schedule=$("#rq_sa_po").val());0!=$("#rq_sa_em").val()&&(b.employees=$("#rq_sa_em").val());spModel.schedule.get("shifts",b,function(b){0<b.data.length?$("#rq_sa_ho").html($.tmpl($("#te_rq_sa"),a.prepareShiftApprovals(b.data))):$("#rq_sa_ho").html(spView.emptyResult())},function(a){sp.showError(a.error)})};
ShiftPlanningRequests.prototype.prepareShiftApprovals=function(a){var b={};$.each(a,function(a,c){var f=c.start_date.formatted+"";"undefined"==typeof b[f]?b[f]={shiftDate:c.start_date.formatted,shifts:[c]}:b[f].shifts.push(c)});var c=[];$.each(b,function(a,b){c.push(b)});return c};
ShiftPlanningRequests.prototype.addVacationRequest=function(a){var b=this;if(0==$.trim($("#rq_va_fr").val()).length)return sp.showError(_s("Please select FROM time")),a.removeClass("loading"),!1;if(0==$.trim($("#rq_va_to").val()).length)return sp.showError(_s("Please select TO time")),a.removeClass("loading"),!1;var c={start_date:$("#rq_va_fr").val(),end_date:$("#rq_va_to").val(),employee:$("#rq_va_en").val(),comments:$("#rq_va_wc").val()};spModel.schedule.create("vacation",c,function(){b.vacationSubEvents();
a.removeClass("loading");$("#rq_va_wc").val("");$("#rq_va_fr").val("");$("#rq_va_to").val("")})};ShiftPlanningRequests.prototype.displayVacationRequest=function(){$("#rq_va_ma_s").html($.tmpl($("#te_rq_va_ma_s"),this.current))};
ShiftPlanningRequests.prototype.displayShiftTradeManager=function(){$("#rq_st_mst_s").html($.tmpl($("#te_rq_st_mst_s"),this.prepareSingleViewTrade(this.current)));$("#rq_st_mts_sub ul a").attr("rel",this.current.id);0==parseInt(this.current.confirm_before)?($("#rq_st_mts_fm").show(),$("#rq_st_mts_sm").hide()):($("#rq_st_mts_sm").show(),$("#rq_st_mts_fm").hide())};
ShiftPlanningRequests.prototype.displayShiftTradeManagerIM=function(){$("#rq_st_im_s").html($.tmpl($("#te_rq_st_im_s"),this.current));$("#rq_st_im_sm a").attr("rel",this.current.id)};ShiftPlanningRequests.prototype.shiftSwapRequestSubEvents=function(){$("#rq_st_sh_swap").html($.tmpl($("#te_rq_st_swap_single"),this.current))};
ShiftPlanningRequests.prototype.displayShiftTradeManagerAP=function(){$("#rq_st_ap_s").html($.tmpl($("#te_rq_st_ap_s"),this.current));$("#rq_st_ap_sub ul a").attr("rel",this.current.trade_id);1==parseInt(this.current.confirmed)?$("#rq_st_ap_sub ul").hide():$("#rq_st_ap_sub ul").show()};
ShiftPlanningRequests.prototype.displayOpenShifts=function(){$("#rq_os_os_s").html($.tmpl($("#te_rq_os_os_s"),this.current));var a="",b="<p>"+_s("You are un-available")+"</p>",c=this.current.status;"undefined"==typeof sp.staff.admin.settings.open_overtime&&(sp.staff.admin.settings.open_overtime=!1);switch(c){case 0:a='<a class="grey" href="#" id="rq_os_rtw" rel="'+this.current.id+_s('"><span>Cancel pending request</span>');this.current.available||(a+=b);break;case 1:a="<p>"+_s("Management rejected your request for this shift")+
"</p>";break;case 2:a="<p>"+_s("Already on this shift")+"</p>";break;case 3:a="<p>"+_s("Booked Off")+"</p>";break;case 5:case 6:a=sp.staff.admin.settings.open_overtime?'<a class="green" href="#" id="rq_os_rtw" rel="'+this.current.id+_s('"><span>Request to work</span>')+"</a>":5==c?"<p>"+_s("Will put you into weekly overtime")+"</p>":"<p>"+_s("Will put you into daily overtime")+"</p>";break;case 7:a="<p>"+_s("Max Days in a Row Breached")+"</p>";break;case 8:a="<p>"+_s("Scheduled during this time")+
"</p>";break;case 9:a="<p>"+_s("Invalid time between shifts")+"</p>";break;case 10:a='<a class="green" href="#" id="rq_os_rtw" rel="'+this.current.id+_s('"><span>Request to work</span>')+"</a>",this.current.available||(a+=b)}$("#rq_os_pickup_req_button").html(a)};ShiftPlanningRequests.prototype.displayOpenRequests=function(){"undefined"==typeof this.current.full&&(this.current.full=this.current);$("#rq_os_spr_s").html($.tmpl($("#te_rq_os_spr_s"),this.current));$("#rq_os_spr_sub a").attr("rel",this.current.full.request_id)};
ShiftPlanningRequests.prototype.shiftApprovalsSingle=function(){$("#rq_sa_s").html($.tmpl($("#te_rq_sa_s"),this.current));$("#rq_sa_s .shiftStartInput").scroller("destroy");$("#rq_sa_s .shiftEndInput").scroller("destroy");$("#rq_sa_s .shiftStartInput").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt","mm"],["A","ii"],cal.tstring)});$("#rq_sa_s .shiftEndInput").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt",
"mm"],["A","ii"],cal.tstring)})};ShiftPlanningRequests.prototype.approveVacationRequest=function(){spModel.schedule.update("vacation",{id:this.current.id,status:1},function(){$(".subNavigation .requests li a[subpage=vacation]").trigger(clickEvent)})};ShiftPlanningRequests.prototype.declineVacationRequest=function(){spModel.schedule.update("vacation",{id:this.current.id,status:-1},function(){$(".subNavigation .requests li a[subpage=vacation]").trigger(clickEvent)})};
ShiftPlanningRequests.prototype.cancelVacationRequest=function(a){spModel.schedule.update("vacation",{id:a,status:-2},function(){$(".subNavigation .requests li a[subpage=vacation]").trigger(clickEvent)})};
ShiftPlanningRequests.prototype.prepareSingleViewTrade=function(a){0==a.traders.count&&(a.traders.data=[]);var b=[];$.each(a.traders.data,function(a,d){d.avatar="undefined"!=typeof sp.staff.data.employees[d.user]&&"undefined"!=typeof sp.staff.data.employees[d.user].avatar&&""!=sp.staff.data.employees[d.user].avatar&&"undefined"!=typeof sp.staff.data.employees[d.user].avatar.small?sp.staff.data.employees[d.user].avatar.small:"images/no-avatar.png";b.push(d)});a.traders.data=b;return a};
ShiftPlanningRequests.prototype.prepareSingleViewSwap=function(){};
ShiftPlanningRequests.prototype.prepareOpenShiftsNA=function(a){var b={};$.each(a,function(a,c){$.each(c.requests,function(a,d){c.user_name=d.name;c.user_id=d.id;c.avatar=sp.getAvatar(d.id);b[c.user_id+c.start_date.formatted+c.start_time.time+c.end_time.time+c.schedule_name]={user_name:d.name,user_id:d.id,start_date:{formatted:c.start_date.formatted},start_time:{time:c.start_time.time},end_time:{time:c.end_time.time},schedule_name:c.schedule_name,notes:c.notes,id:c.id,rId:c.request_id,full:c}})});
var c=[];$.each(b,function(a,b){c.push(b)});return c};ShiftPlanningRequests.prototype.saveShiftApprove=function(){var a=[];$.each($("#rq_sa_s .save"),function(){var b={employee:$(this).attr("userId"),id:$(this).attr("shiftId"),start_time:$(this).find(".shiftStartInput").val(),end_time:$(this).find(".shiftEndInput").val()};$(this).find(".checkbox").hasClass("check")||(b.absent=1);a.push(["schedule.shiftapprove","update",b])});sp.multiApi(a,function(){$(".subNavigation .requests li a[subpage=shiftApprovals]").trigger(clickEvent)})};
ShiftPlanningRequests.prototype.addShift=function(a,b,c){"undefined"!=typeof c?this.shifts[parseInt(a)+""][c]=b:this.shifts[parseInt(a)+""]=b};ShiftPlanningRequests.prototype.getShift=function(a){return this.shifts[a]};ShiftPlanningRequests.prototype.fixShiftsApproval=function(a){null!=a.employees&&$.each(a.employees,function(b){"undefined"==typeof a.employees[b].shift&&(a.employees[b].shift=a,a.employees[b].shift.absent=0)});return a};ShiftPlanningRequests.prototype.loadPage=function(){};
ShiftPlanningSchedule.prototype.initialize=function(){var a=this;$(document).ready(function(){a.allPageEvents()})};
ShiftPlanningSchedule.prototype.allPageEvents=function(){var a=this;$("#sc_fl").bind("change",function(){var b=$(this).val();parseInt(b)!=b?a.settings.mode=b:(a.settings.mode="schedule",a.settings.schedule=b);a.displayShifts()});$("#sc_prev_day").bind(clickEvent,function(b){b.preventDefault();$("#sc_to_sub").html(Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).add(-1).day().toString(cal.dformat));a.nextPrevPrepare("prev")});$("#sc_next_day").bind(clickEvent,function(b){b.preventDefault();
$("#sc_to_sub").html(Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).add(1).day().toString(cal.dformat));a.nextPrevPrepare("next")});$("#sc_prev_month").bind(clickEvent,function(b){b.preventDefault();$("#sc_mo_di").html(Date.parse($.trim($("#sc_mo_di").html())).addMonths(-1).toString("MMMM yyyy"));$("#sc_days_m").hide();a.displayShifts()});$("#sc_next_month").bind(clickEvent,function(b){b.preventDefault();$("#sc_mo_di").html(Date.parse($.trim($("#sc_mo_di").html())).addMonths(1).toString("MMMM yyyy"));
$("#sc_days_m").hide();a.displayShifts()});$("#sc_ca_bo").delegate("td:not(.notM)",clickEvent,function(){$("#sc_ca_bo td").removeClass("today");$(this).addClass("today");var b=$(this).attr("time");"undefined"!=typeof a.shifts[b]?($("#sc_td_list").show(),$("#sc_td .loading").hide(),$("#sc_td .additional").hide(),$("#sc_td_list").html('<ul class="shifts moved"></ul>'),$("#sc_td_list ul").html($.tmpl($("#te_sc_shifts_new"),a.shifts[b].shifts)),$("#sc_td_list .isShift > p").each(function(){$(this).html($(this).html().substring(0,
$(this).html().length-1))})):($("#sc_td_list").hide(),$("#sc_td .loading").hide(),$("#sc_td .additional").show());$("#sc_to_sub").html(Date.parse(b+" "+$.trim($("#sc_mo_di").html())).toString(cal.dformat));$("#sc_days_m").show()});$("#sc_td_list").delegate("a",clickEvent,function(b){b.preventDefault();if(!$(this).hasClass("isShift"))return!1;$(this).parent().addClass("loading");spModel.schedule.get("shift",{id:$(this).attr("rel"),detailed:1},function(b){a.shift=b.data;sp.loadSubPage("","schedule",
"shiftDisplay")})});$("#schedule .shiftDisplay .backMenu").bind(clickEvent,function(b){b.preventDefault();b.stopPropagation();a.fromUpcoming?(a.fromUpcoming=!1,$(".subNavigation").show(),a.fromStaff?(a.fromStaff=!1,$(".subNavigation .schedule").hide(),$(".staff .subWrapp ul li a[subpage=list]").trigger(clickEvent),sp.staff.displayEmployee($("#da_se_cur_us_id").val()),$("#settings .search.settings.mainSub li a[subpage=upcomingShifts]").trigger(clickEvent)):$(".subNavigation .settings li a[subpage=upcomingShifts]").trigger(clickEvent)):
a.fromRecent?(a.fromRecent=!1,$(".subNavigation").show(),a.fromStaff?(a.fromStaff=!1,$(".subNavigation .schedule").hide(),$(".staff .subWrapp ul li a[subpage=list]").trigger(clickEvent),sp.staff.displayEmployee($("#da_se_cur_us_id").val()),$("#settings .search.settings.mainSub li a[subpage=recentShifts]").trigger(clickEvent)):$(".subNavigation .settings li a[subpage=recentShifts]").trigger(clickEvent)):(a.fromDashboard&&(a.fromDashboard=!1,$(".subNavigation").show(),$(".subNavigation .dashboard li a[subpage=dashboard]").trigger(clickEvent)),
a.fromDashboardUpcoming?(a.fromDashboardUpcoming=!1,$(".subNavigation").show(),$(".subNavigation .dashboard li a[subpage=upcomingShifts]").trigger(clickEvent)):"false"==$("#sc_sub_shift_display ul a.publish").attr("first")?a.resetPublishFields(!0):$(".subNavigation .schedule .schedule li.active a").trigger(clickEvent))});$(".shiftDisplay ").delegate("#get_directions",clickEvent,function(b){var c=this,d=_s("There is no default address in your profile.Enter starting point address.");if(null==a.shift.user_location){var e=
!1,f=function(){e=!0;d=_s("Application didn't get GPS coordinates.Enter starting point address.");g()},g=function(){var e=prompt(d,"");a.shift.user_location=e;var f="http://"+googleIp+"/maps/?f=d&hl=en&geocode=&saddr="+e+"&daddr="+a.shift.location.address+"&ie=UTF8&z=7&output=embed";$(c).attr("href",f);null!=e?window.open(f,"_blank"):b.preventDefault()};"undefined"!=typeof navigator.geolocation?(b.preventDefault(),setTimeout(function(){e||f()},1E4),sp.showSuccess("Getting coordinates . . ."),navigator.geolocation.getCurrentPosition(function(b){"function"!=
typeof b&&(a.shift.user_location=""+b.coords.latitude+","+b.coords.longitude+"",b="http://"+googleIp+"/maps/?f=d&hl=en&geocode=&saddr="+a.shift.user_location+"&daddr="+a.shift.location.address+"&ie=UTF8&z=7&output=embed",$(c).attr("href",b),e=!0,window.open(b,"_blank"))},f)):g()}});$("#schedule .addShift .backMenu").bind(clickEvent,function(b){b.preventDefault();"edit"==$(this).attr("bck")?spModel.schedule.get("shift",{id:$("#sc_edit_id").val(),detailed:1},function(b){a.shift=b.data;sp.loadSubPage("",
"schedule","shiftDisplay")}):$(".subNavigation .schedule .schedule li.active a").trigger(clickEvent)});$("#sc_sub_shift_display ul a.edit").bind(clickEvent,function(b){b.preventDefault();var c=$(this);c.addClass("loading");spModel.schedule.get("shift",{id:$(this).attr("rel"),detailed:1},function(b){c.removeClass("loading");a.shift=b.data;a.edit=!0;sp.loadSubPage("","schedule","addShift")},function(){c.removeClass("loading")})});$("#sc_sub_shift_display ul a.delete").bind(clickEvent,function(b){b.preventDefault();
var c=$(this).attr("rel"),d=$(this);"true"==$(this).attr("first")?(spModel.schedule.del("shift",{id:c,rule:$("#te_sc_shift_display_delete .radio.check").attr("value")},function(a){sp.showSuccess(a.data);setTimeout(function(){$("#schedule .shiftDisplay .backMenu").trigger(clickEvent)},3E3)}),d.attr("first","false")):spModel.schedule.get("shift",{id:c,detailed:1},function(b){a.shift=b.data;"undefined"==typeof a.shift.repeats||0==a.shift.repeats?spModel.schedule.del("shift",{id:c},function(a){sp.showSuccess(a.data);
setTimeout(function(){$("#schedule .shiftDisplay .backMenu").trigger(clickEvent)},3E3)}):($("#te_sc_shift_display_info").hide(),$("#te_sc_shift_display_delete").show(),d.attr("first","true"))})});$("#sc_sub_trade a.backMenu").bind(clickEvent,function(b){b.preventDefault();sp.loadSubPage("","schedule","shiftDisplay");a.state=1});$("#cs_sh_trade").delegate(".chk",clickEvent,function(a){a.preventDefault();$(this).hasClass("all")?$(this).hasClass("check")?$("#empList0 .chk").removeClass("check"):$("#empList0 .chk").addClass("check"):
$(this).toggleClass("check")});$("#empList1").delegate(".checkbox",clickEvent,function(a){a.preventDefault();var c=this,a=$(this).attr("rel");$(this).parent().addClass("loading");!$(this).hasClass("check")&&!$(this).hasClass("disabled")?spModel.schedule.get("shift",{id:a,detailed:1},function(a){var b=!1;a.data.length&&0<a.data.staff.available.length&&$.each(a.data.staff.available,function(a,c){b=c[0]==sp.staff.admin.info.id?!0:b});"1"==sp.staff.admin.business.pref_same_day_trades&&(a.data.length&&
0<a.data.staff.sameday.length)&&$.each(a.data.staff.sameday,function(a,c){b=c[0]==sp.staff.admin.info.id?!0:b});b?($(c).addClass("check"),$(c).parent().removeClass("loading")):($(c).addClass("disabled"),$(c).parent().removeClass("loading"),sp.showError("You aren't available for this shift!"))}):($(this).removeClass("check"),$(this).parent().removeClass("loading"))});$("#sc_sub_shift_display ul a.trade").bind(clickEvent,function(a){a.preventDefault();sp.loadSubPage("","schedule","trade")});$("#schedule .trade").delegate(".tradepick a",
clickEvent,function(b){b.preventDefault();var c=$(this).attr("id"),d=this;$(this).addClass("loading");setTimeout(function(){$("#cs_sh_trade .steps").show();$("#schedule .trade>div").hide();$("#te_sc_shift_display_trade_"+c).show();$('#schedule .trade>div [step^="step"]').hide();$("#schedule .trade>div [step=step_"+a.state+"]").show();$("span[rel=self_state]").html(a.state);$(d).removeClass("loading")},400)});$("#te_sc_shift_display_trade_swap,#te_sc_shift_display_trade_release").delegate(".steps a",
clickEvent,function(b){b.preventDefault();var b=$(this).attr("id"),c=$(this).attr("swap"),d=this;$(this).addClass("loading");"_back"==b?a.state-=1:"_next"==b&&(a.state+=1);switch(a.state){case 0:case -1:setTimeout(function(){$("#schedule .trade>div").hide();$("#schedule .trade>div:first").show();a.state=1;$("span[rel=self_state]").html(a.state);$(d).removeClass("loading")},400);break;case 2:spModel.schedule.get("tradelist",{id:a.shift.id,swap:c},function(b){var e=[];$.each(b.data,function(a,b){var d=
{};d.id=a;d.avatar=sp.getAvatar(a);d.name=b.name;"undefined"!=typeof b.shifts?(d.shifts=[],$.each(b.shifts,function(a,b){var c={};c.id=a;c.user_shift_id=b.user_shift_id;c.start=b.start;d.shifts.push(c)}),e.push(d)):0==c&&e.push(d)});$("#empList"+c).html("");0==c&&0<e.length&&$("#empList"+c).append('<li><span class="chk all"></span> <span class="name">'+_s("Select All")+"</span></li>");1==c&&0==e.length&&$("#empList"+c).append("<li>"+_s("There are no available shifts to trade")+"</li>");$("#empList"+
c).append($.tmpl($("#te_sc_shift_release"+c),e));$('#schedule .trade>div [step^="step"]').hide();$("#schedule .trade>div [step=step_"+a.state+"]").show();$("span[rel=self_state]").html(a.state);$(d).removeClass("loading")});break;case 3:var e=$("#empList"+c+" .check:not(.all)"),b="0"==c?"trade":"tradeswap",f="0"==c?"tradewith":"swap";if(!e.length)return sp.showError(_s("You need to select at least one item")),$(d).removeClass("loading"),a.state-=1,!1;var g=[];e.each(function(a,b){"swap"==f?g.push($(b).attr("user_shift_id")):
g.push($(b).attr("rel"))});e={};e[f]=g.join(",");e.shift=a.shift.id;e.reason=$("textarea[name=reason_trade"+c+"]").val();spModel.schedule.create(b,e,function(){a.state=3;$('#schedule .trade>div [step^="step"]').hide();$("#schedule .trade>div [step=step_"+a.state+"]").show();$("span[rel=self_state]").html(a.state);$(d).removeClass("loading");$("#cs_sh_trade .steps").hide();$("#sc_sub_shift_display a.trade").hide();a.state=1});a.state=2;break;default:setTimeout(function(){a.state=3<a.state?3:a.state;
a.state=0>a.state?1:a.state;$('#schedule .trade>div [step^="step"]').hide();$("#schedule .trade>div [step=step_"+a.state+"]").show();$("span[rel=self_state]").html(a.state);$(d).removeClass("loading")},400)}});$("#sc_sub_shift_display ul a.publish").bind(clickEvent,function(b){b.preventDefault();if("true"==$(this).attr("first"))return $("#te_sc_shift_display_info").hide(),$("#te_sc_shift_display_publish").show(),$(this).attr("first","false"),!1;var c=$(this);c.addClass("loading");"undefined"!=typeof a.conflicts[c.attr("rel")]?
confirm(a.conflicts[c.attr("rel")].title)?spModel.schedule.get("publish",{shifts:c.attr("rel"),notify:$("#te_sc_shift_display_publish .radio.check").attr("value"),message:$("#tc_sc_shift_display_publish_textarea textarea").val()},function(b){sp.showSuccess(b.data);c.removeClass("loading");c.hide();a.resetPublishFields(!0)}):c.removeClass("loading"):spModel.schedule.get("conflicts",{schedule:$(this).attr("rel")},function(b){a.setConflicts(b.data);"undefined"!=typeof a.conflicts[c.attr("rel")]?confirm(_s("This shift has conflicts, but you can't fix them from mobile app. Force publish?"))?
spModel.schedule.get("publish",{shifts:c.attr("rel"),notify:$("#te_sc_shift_display_publish .radio.check").attr("value"),message:$("#tc_sc_shift_display_publish_textarea textarea").val()},function(b){sp.showSuccess(b.data);c.removeClass("loading");c.hide();a.resetPublishFields(!0)}):c.removeClass("loading"):spModel.schedule.get("publish",{shifts:c.attr("rel"),notify:$("#te_sc_shift_display_publish .radio.check").attr("value"),message:$("#tc_sc_shift_display_publish_textarea textarea").val()},function(b){sp.showSuccess(b.data);
c.removeClass("loading");c.hide();a.resetPublishFields(!0)})})});$("#sc_shift_display").delegate("#te_sc_shift_display_publish .radio",clickEvent,function(){$("#te_sc_shift_display_publish .radio").removeClass("check");$(this).addClass("check")});$("#sc_shift_display").delegate("#te_sc_shift_display_delete .radio",clickEvent,function(){$("#te_sc_shift_display_delete .radio").removeClass("check");$(this).addClass("check")});$("#sc_shift_display").delegate("#te_sc_shift_display_publish .checkbox",clickEvent,
function(){$(this).toggleClass("check");$("#tc_sc_shift_display_publish_textarea").toggle()});$("#sc_refresh").bind(clickEvent,function(b){$(this).parent().removeClass("active");b.preventDefault();a.displayShifts()});$("#sc_add").bind(clickEvent,function(a){a.preventDefault();sp.loadSubPage("","schedule","addShift")});$("#sc_add_add").bind(clickEvent,function(b){b.preventDefault();var c=$(this),d=0!=$("#sc_edit_id").val()?!0:!1;c.addClass("loading");var b={schedule:$("#sc_add_sc").val(),location:$("#sc_add_lo").val(),
title:$("#sc_add_ti").val(),start_time:$("#sc_date_st").val(),end_time:$("#sc_date_et").val(),start_date:$("#sc_date_sd").val(),end_date:$("#sc_date_ed").val(),notes:$("#sc_add_no").val()},e="create";d&&(e="update",b.id=$("#sc_edit_id").val());spModel.schedule[e]("shift",b,function(b){spModel.schedule.get("shift",{id:b.data.id,detailed:1},function(b){d?spModel.schedule.get("shift",{id:$("#sc_edit_id").val(),detailed:1},function(b){a.shift=b.data;sp.loadSubPage("","schedule","shiftDisplay");sp.showSuccess(_s("Shift Updated"))}):
(c.removeClass("loading"),a.shift=b.data,a.edit=!0,sp.loadSubPage("","schedule","addShift"))})},function(){c.removeClass("loading")})});$("#sc_add_user").delegate(".checkbox",clickEvent,function(){var b={id:$("#sc_edit_id").val()},c=$(this);c.parent().addClass("loading");c.hasClass("check")?b.remove=c.attr("user"):b.add=c.attr("user");spModel.schedule.update("shift",b,function(b){spModel.schedule.get("shift",{id:b.data.id,detailed:1},function(b){c.parent().removeClass("loading");a.shift=b.data;a.edit=
!0;sp.loadSubPage("","schedule","addShift")},function(){c.parent().removeClass("loading")})},function(){c.parent().removeClass("loading")})});$("#sc_edit_submenu .subNav a").bind(clickEvent,function(a){var c=$(this);a.preventDefault();c.addClass("loading");spModel.schedule.update("shiftapprove",{id:$("#sc_edit_id").val()},function(){sp.showSuccess(_s("Shift approved"));c.removeClass("loading");c.hide()},function(){c.removeClass("loading")})})};
ShiftPlanningSchedule.prototype.loadSubPageEvents=function(a){$("#sc_edit_id").val(0);$(".subNavigation").show();$("#sc_additional_menu").show();$("#sc_to_sub").html(sp.raw.config.today.formatted);var b;b=""+_s('<option value="employee">My Schedules</option>');if(1==parseInt(sp.staff.admin.settings.visible_overview)||5>parseInt(sp.staff.admin.info.group))b+=_s('<option value="overview">Schedule Overview</option>');b+=spView.schedulerFilter();$("#sc_fl").html(b);("shiftDisplay"==a||"addShift"==a||
"trade"==a)&&$(".subNavigation").hide();"addShift"==a&&$("#sc_additional_menu").hide();this[a+"SubEvents"]()};ShiftPlanningSchedule.prototype.todaySubEvents=function(){$("#sc_to_sub").prev().html("Today");this.page="today";this.displayShifts()};
ShiftPlanningSchedule.prototype.tradeSubEvents=function(){$("#schedule .trade>div").hide();$("#schedule .trade>div:first").show();$("#cs_sh_trade ul.shifts").html($.tmpl($("#te_cs_sh"),this.shift));$(".tradepick li").show();"1"!=sp.staff.admin.settings.trade_shifts&&$("#release").parent().parent().hide();"1"!=sp.staff.admin.business.pref_swap_shifts&&$("#swap").parent().parent().hide()};
ShiftPlanningSchedule.prototype.daySubEvents=function(){this.page="day";$("#sc_to_sub").prev().html("Current Day");this.displayShifts()};ShiftPlanningSchedule.prototype.monthSubEvents=function(){this.page="month";$("#sc_to_sub").prev().html("Selected Day");$("#sc_mo_di").html(Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).add(1).day().toString("MMMM yyyy"));this.displayShifts()};
ShiftPlanningSchedule.prototype.shiftDisplaySubEvents=function(){this.shift=this.cleanPerm(this.shift);$("#sc_sub_shift_display a.trade").hide();this.fromDashboard||this.fromRecent||this.fromUpcoming?($("#sc_sub_shift_display a.delete").hide(),$("#sc_sub_shift_display a.edit").hide(),$("#sc_sub_shift_display a.publish").hide()):(0==this.shift.perms?($("#sc_sub_shift_display a.delete").hide(),$("#sc_sub_shift_display a.edit").hide(),$("#sc_sub_shift_display a.publish").hide(),$("#sc_sub_shift_display a.trade").hide()):
1==this.shift.perms?($("#sc_sub_shift_display a.delete").hide(),$("#sc_sub_shift_display a.edit").hide(),$("#sc_sub_shift_display a.publish").hide(),$("#sc_sub_shift_display a.trade").hide()):(0==this.shift.published?($("#sc_sub_shift_display a.publish").show(),$("#sc_sub_shift_display a.publish span").html('<img width="16" height="17" src="images/approve.png">')):this.shift.published<this.shift.edited&&0!=this.shift.published?($("#sc_sub_shift_display a.publish").show(),$("#sc_sub_shift_display a.publish span").html()):
$("#sc_sub_shift_display a.publish").hide(),0==sp.staff.admin.settings.draft&&$("#sc_sub_shift_display a.publish").hide(),$("#sc_sub_shift_display a.delete").show(),$("#sc_sub_shift_display a.edit").show()),$("#sc_sub_shift_display a.publish").attr("first","true"));var a=[];"undefined"!=typeof this.shift.employees&&null!=this.shift.employees?($.each(this.shift.employees,function(b,c){a[b]=c;a[b].avatar="undefined"!=typeof sp.staff.data.employees[c.userid]&&"undefined"!=typeof sp.staff.data.employees[c.userid].avatar&&
""!=sp.staff.data.employees[c.userid].avatar&&"undefined"!=typeof sp.staff.data.employees[c.userid].avatar.small?sp.staff.data.employees[c.userid].avatar.small:"images/no-avatar.png"}),this.shift.employees=a):this.shift.employees=[];this.shift.user_location=this.getLocation();$("#sc_shift_display").html($.tmpl($("#te_sc_shift_display"),this.shift));this.resetPublishFields(!0);null!=this.shift.trades&&""!=this.shift.trades||"1"!=sp.staff.admin.settings.trade_shifts&&"1"!=sp.staff.admin.business.pref_swap_shifts?
$("#sc_sub_shift_display a.trade").hide():$.each(this.shift.employees,function(a,c){c.id==sp.staff.admin.info.id&&$("#sc_sub_shift_display a.trade").show()});$("#sc_sub_shift_display ul a").attr("rel",this.shift.id);0!=this.shift.location&&$("#sc_location_iframe").html('<iframe  id="map" width="100%" height="220" frameborder="0" scrolling="no" src="http://'+googleIp+"/maps/?f=d&source=s_d&saddr="+this.shift.location.address+'&hl=en&z=15&output=embed"></iframe>')};
ShiftPlanningSchedule.prototype.resetPublishFields=function(a){"undefined"==typeof a&&(a=!1);a&&($("#te_sc_shift_display_publish").hide(),$("#te_sc_shift_display_info").show());$("#te_sc_shift_display_publish .radio").removeClass("check");$("#te_sc_shift_display_publish .checkbox").removeClass("check");$("#te_sc_shift_display_publish .radio[value=1]").addClass("check");$("#tc_sc_shift_display_publish_textarea").hide();$("#tc_sc_shift_display_publish_textarea textarea").val("");$("#sc_sub_shift_display ul a.publish").attr("first",
"true")};
ShiftPlanningSchedule.prototype.addShiftSubEvents=function(){var a=this;$("#sc_add_user").hide();$("#sc_add_sc").html(spView.schedulerFilter(0,!0));$("#sc_add_lo").html(spView.locationSelector());$("#sc_add_add").removeClass("loading");var b={};!1!=this.edit?(b=this.shift,b.start_date.formatted=Date.parse(b.start_date.formatted+" "+b.start_time.time).getTime()/1E3,b.end_date.formatted=Date.parse(b.end_date.formatted+" "+b.end_time.time).getTime()/1E3,null!=b.schedule&&$("#sc_add_sc").val(b.schedule),null!=
b.schedule&&$("#sc_add_sc").val(b.schedule)):(b.start_date={},b.end_date={},b.start_date.formatted=Date.parse("today at 9am").getTime()/1E3,b.end_date.formatted=Date.parse("today at 5pm").getTime()/1E3);var c=new Date(1E3*b.start_date.formatted),d=new Date(1E3*b.end_date.formatted),e=24==cal.tmode?"HH:mm":"hh:mm tt";$("#sc_date_st").scroller("destroy");$("#sc_date_st").val(c.toString(e));$("#sc_date_st").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt",
"mm"],["A","ii"],cal.tstring)});$("#sc_date_et").scroller("destroy");$("#sc_date_et").val(d.toString(e));$("#sc_date_et").scroller({preset:"time",ampm:24==cal.tmode?!1:!0,stepMinute:15,timeFormat:sp.strReplace(["tt","mm"],["A","ii"],cal.tstring)});$("#sc_date_sd").scroller("destroy");$("#sc_date_sd").val(c.toString(cal.dformat));$("#sc_date_sd").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,
sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat)});$("#sc_date_ed").scroller("destroy");$("#sc_date_ed").val(d.toString(cal.dformat));$("#sc_date_ed").scroller({preset:"date",dateFormat:"mmM d, yy"==sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat)?sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat).substr(2,sp.strReplace(["MM","yyyy"],["mm","yy"],
cal.dformat).length):sp.strReplace(["MM","yyyy"],["mm","yy"],cal.dformat),dateOrder:sp.strReplace(["MM","yyyy"," ","-","/"],["mm","yy","","",""],cal.dformat)});$("#sc_add_no").val(this.edit?b.notes:"");$("#sc_add_ti").val(this.edit?b.title:"");$("#sc_add_lo").val(this.edit?0!=b.location?b.location.id:0:0);this.edit?($("#sc_add_add span").html(_s("Save Shift")),$("#sc_edit_id").val(b.id),$("#sc_edit_submenu .backMenu").attr("bck","edit"),0==b.confirmed&&b.end_date.id<sp.raw.config.today.id&&1==sp.staff.admin.settings.shift_confirm?
$("#sc_edit_submenu .subNav").show():$("#sc_edit_submenu .subNav").hide()):($("#sc_edit_submenu .subNav").hide(),$("#sc_edit_submenu .backMenu").attr("bck","add"),$("#sc_add_add span").html(_s("Add Shift And Set Users")));this.edit&&($("#sc_add_user .working ul").html(null==b.staff.scheduled?spView.emptyResult(_s("No scheduled employees for selected shift"),"li"):$.tmpl($("#te_sc_usersW"),this.prepareStaff(b.staff.scheduled))),delete b.staff.scheduled,$.each(b.staff,function(b,c){null==c||0==c.length?
$("#sc_add_user div[type="+b+"]").hide():($("#sc_add_user div[type="+b+"] ul.detailsGrid li ul").html($.tmpl($("#te_sc_users"),a.prepareStaff(c))),$("#sc_add_user div[type="+b+"]").show())}),$.each($("#sc_add_user .detailsGrid ul"),function(a,b){$.each($(b).find("li"),function(a){0==a%2?$(this).addClass("even"):$(this).addClass("odd")})}),$("#sc_add_user").show());this.edit=!1};
ShiftPlanningSchedule.prototype.getLocation=function(){var a=[],b=["city","state","address"];return sp.staff.admin.info.city||sp.staff.admin.info.state||sp.staff.admin.info.address?($.each(b,function(b,d){""!=sp.staff.admin.info[d]&&a.push(sp.staff.admin.info[d])}),a.join(",")):null};ShiftPlanningSchedule.prototype.prepareStaff=function(a){for(var b=a.length,c=[];b--;)c.push(sp.staff.data.employees[a[b][0]]);return c};
ShiftPlanningSchedule.prototype.nextPrevPrepare=function(a){$("#sc_mo_di").html(Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).toString("MMMM yyyy"));if("today"==this.page)$(".subNavigation .schedule li a[subpage=day]").trigger(clickEvent);else if("day"==this.page)this.displayShifts();else if("month"==this.page){var b=parseInt($("#sc_ca_bo .today").attr("time")),c=$.trim($("#sc_mo_di").html());Date.parse(c).moveToFirstDayOfMonth().getDate();c=Date.parse(c).moveToLastDayOfMonth().getDate();
"prev"==a?1==b?this.displayShifts(c):(b--,$("#sc_ca_fi_"+b).trigger(clickEvent)):(b++,0==$("#sc_ca_fi_"+b).length?this.displayShifts(1):$("#sc_ca_fi_"+b).trigger(clickEvent))}};
ShiftPlanningSchedule.prototype.displayShifts=function(a){var b=this;"month"==this.page&&this.generateCalendar();$("#sc_td_list").hide();$("#sc_td .loading").show();$("#sc_td .additional").hide();$("#sc_ca_bo").parent().addClass("loading");$("#schedule").show();$(".subNavigation .schedule").show();var c=this.getSettings();spModel.schedule.get("shifts",c,function(c){$("#sc_ca_bo").parent().removeClass("loading");0<c.data.length?(c.data=b.cleanPerms(c.data),"month"==b.page?(b.fillCalendar(c.data),$("#sc_td_list").html($.tmpl($("#te_sc_shifts_months"),
b.shifts)),"undefined"!=typeof a&&$("#sc_ca_fi_"+a).trigger(clickEvent)):($("#sc_td_list").html('<ul class="shifts moved"></ul>'),$("#sc_td_list ul").html($.tmpl($("#te_sc_shifts_new"),c.data))),$("#sc_td_list").show(),$("#sc_td .loading").hide(),$("#sc_td_list .dTitle  span").each(function(){var a=$(this).find("t:last");null!=$(a).html()&&$(a).html($(a).html().substr(0,$(a).html().length-2))})):("month"==b.page&&"undefined"!=typeof a&&$("#sc_ca_fi_"+a).trigger(clickEvent),$("#sc_td_list").hide(),
$("#sc_td .loading").hide(),$("#sc_td .additional").show());$("#sc_td_list .isShift > p").each(function(){$(this).html($(this).html().substring(0,$(this).html().length-1))})})};ShiftPlanningSchedule.prototype.cleanPerms=function(a){var b=this;$.each(a,function(c,d){a[c]=b.cleanPerm(d)});return a};
ShiftPlanningSchedule.prototype.cleanPerm=function(a){if(null!=a.employees&&2>a.perms&&0==sp.staff.admin.settings.visible_coworkers){var b=[];$.each(a.employees,function(a,d){d.id==sp.staff.admin.info.id&&b.push(d)});a.employees=b}return a};ShiftPlanningSchedule.prototype.clearSchedules=function(){var a={};$.each(sp.schedule.data.schedules,function(b,c){spView.checkPerm(c,!0)&&(a[b+""]=c)});return a};
ShiftPlanningSchedule.prototype.checkSchedulePerm=function(a){return"undefined"==typeof sp.schedule.data.schedules[a]?0:sp.schedule.data.schedules[a].perms};
ShiftPlanningSchedule.prototype.fillCalendar=function(a){var b={};$.each(a,function(a,c){"undefined"==typeof b[c.start_date.day+""]&&(b[c.start_date.day+""]={dateToday:c.start_date.formatted,shifts:[]});b[c.start_date.day+""].shifts.push(c)});$("#sc_ca_bo td").removeClass("hasAny");var c=[];$.each(b,function(a,b){c[a]=b;$("#sc_ca_fi_"+a).addClass("hasAny")});this.shifts=c};
ShiftPlanningSchedule.prototype.getColorsBySchedule=function(a,b){return"undefined"!=typeof sp.schedule.data.schedules[a]?"undefined"!=typeof b?sp.raw.config.newcolorsets[sp.schedule.data.schedules[a].color][b]:sp.raw.config.newcolorsets[sp.schedule.data.schedules[a].color]:["000","aaa","fff","fff","000"]};
ShiftPlanningSchedule.prototype.getSettings=function(){"month"!=this.page?(this.settings.start_date=Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).toString(cal.dformat),this.settings.end_date=Date.parseExact($.trim($("#sc_to_sub").html()),cal.dformat).toString(cal.dformat)):(this.settings.start_date=Date.parse($.trim($("#sc_mo_di").html())).moveToFirstDayOfMonth().toString(cal.dformat),this.settings.end_date=Date.parse($.trim($("#sc_mo_di").html())).moveToLastDayOfMonth().toString(cal.dformat));
return this.settings};ShiftPlanningSchedule.prototype.setSettings=function(){$("#sc_start_day").val(this.settings.start_date);$("#sc_end_day").val(this.settings.end_day);$("#sc_mode").val(this.settings.end_day);$("#sc_schedule").val(this.settings.end_day)};ShiftPlanningSchedule.prototype.generateCalendar=function(){$("#sc_ca_he").html(this.generateTop());$("#sc_ca_bo").html(this.generateMiddle())};
ShiftPlanningSchedule.prototype.generateTop=function(){var a=cal.startday-1,b="";if(0<a){for(var c=a;7>c;c++)b+="<th>"+daysOfWeekS[c]+"</th>";for(c=0;c<a;c++)b+="<th>"+daysOfWeekS[c]+"</th>"}else for(c=0;7>c;c++)b+="<th>"+daysOfWeekS[c]+"</th>";return b};
ShiftPlanningSchedule.prototype.generateMiddle=function(a){for(var a="undefined"==typeof a?$.trim($("#sc_mo_di").html()):a,b=Date.parse(a).moveToFirstDayOfMonth().getDate(),c=Date.parse(a).moveToLastDayOfMonth().getDate(),d=Date.parse(a).moveToFirstDayOfMonth().getDay()-(cal.startday-1),e=Date.parse($.trim($("#sc_to_sub").html())).addMonths(-1).moveToLastDayOfMonth().getDate(),a="",f=[],d=e-(0<=d?d:7+d)+1;d<=e;d++)f.push('<td class="notM">'+d+"</td>");for(d=b;d<=c;d++)f.push('<td id="sc_ca_fi_'+d+
'" time="'+d+'">'+d+"</td>");b=7-f.length%7;for(d=1;d<=b;d++)f.push('<td class="notM">'+d+"</td>");for(b=0;b<f.length/7;b++)a+="<tr>"+f.slice(7*b,7*(b+1)).join("")+"</tr>";return a};ShiftPlanningSchedule.prototype.loadPage=function(){var a=!1;$.each(this.data.schedules,function(b,c){if(2==c.perms)return a=!0});a||$("#sc_add").parent().hide();this.generateCalendar()};ShiftPlanningPermissions.prototype.initialize=function(){var a=this;$(document).ready(function(){1==user.loggedIn&&a.preparePermissions()})};
ShiftPlanningPermissions.prototype.preparePermissions=function(){var a=sp.staff.admin.settings,b=sp.staff.admin.info.group;0==parseInt(a.message_wall_on)&&($("#da_wa_nm_b").remove(),$("#da_wa_nm_f").remove(),$("#da_wa_li").html(spView.emptyResult(_s("Message wall is off. Please contact your manager for more info."),"li")));b>this.supervisor&&0==parseInt(a.message_wall_emp)&&($("#da_wa_nm_b").remove(),$("#da_wa_nm_f").remove());0==parseInt(a.message_wall_comments)&&$("#da_wa_li").addClass("permMsgCommentOff");
b>=this.scheduler&&0==parseInt(a.pm)&&($("#da_in_nm_b").unbind(clickEvent),$("#da_in_nm_b").remove());0==a.shift_confirm&&$(".subNavigation .reports a[subpage=confirmedHours]").remove();b>=this.employee&&($("#da_se_ov_no, #da_se_ed_no").parents(".detailsGrid").remove(),$("#tc_mts_sub_button").remove(),$("#tc_mts").remove(),$(".subNavigation .requests a[subpage=shiftApprovals]").remove(),$("#rq_sa").remove());b>=this.scheduler&&($("#menu_reports").remove(),$("#reports").remove(),$("#settings .aPerm").remove(),
$(".subNavigation .staff a[subpage=addStaff]").remove(),$(".subNavigation .staff a[subpage=fastAssignment]").remove(),$("#staff .addStaff").remove(),$("#st_fa").remove());b>=this.scheduler&&0==parseInt(a.tc_empl_addtime)&&$("#tc_act_sub_button").remove();0==parseInt(a.timeclock)&&($("#menu #menu_timeClock").unbind(clickEvent),$("#da_widgets .timeClock").remove(),$("#menu #menu_timeClock").remove(),$("#timeClock").remove(),$(".subNavigation div.timeClock").remove(),$(".subNavigation .reports a[subpage=confirmedTimeSheets]").remove());
b>=this.employee&&0==parseInt(a.visible_staff)&&($("#menu #menu_staff").unbind(clickEvent),$("#menu #menu_staff").remove(),$("#staff").remove(),$(".subNavigation div.staff").remove());b>=this.scheduler&&0==parseInt(a.edit_profile)&&$(".subNavigation .settings .subNav a[subpage=edit]").hide()};
ShiftPlanningPermissions.prototype.hasPermission=function(a){var b=sp.staff.admin.settings,c=sp.staff.admin.info.group;switch(a){case "visible_staff_details":if(c>=this.employee&&0==parseInt(b.visible_staff_details))return!1;break;case "edit_profile":if(c>this.scheduler&&0==parseInt(b.edit_profile))return!1;break;case "message_wall_comments":if(c>this.manager&&0==parseInt(b.message_wall_comments))return!1}return!0};
ShiftPlanningPermissions.prototype.fixStaffListing=function(){var a=sp.staff.data.employees,b=sp.schedule.clearSchedules(),c={};$.each(b,function(b,e){$.each(a,function(a,b){null!=b.schedules&&"undefined"!=typeof b.schedules[e.id]&&(c[b.id+""]=b)})});return c};ShiftPlanningTraining.prototype.initialize=function(){var a=this;$(document).ready(function(){a.overviewEvents()})};ShiftPlanningTraining.prototype.loadSubPageEvents=function(a){this[a+"SubEvents"]()};
ShiftPlanningTraining.prototype.overviewEvents=function(){$("#training .training .filters li a").bind(clickEvent,function(a){a.preventDefault();a.stopPropagation();a=$(this).attr("subpage");$("#training .training .filters li").removeClass("active");$(this).parent().addClass("active");sp.loadSubPage("","training",a)});$("#training .training_sections").delegate("div[rel]",clickEvent,function(){sp.training.tmp_section=$(this).attr("rel");sp.loadSubPage("","training","singleSection")});$("#training .training_singleSection").delegate("div[rel]",
clickEvent,function(){sp.training.tmp_module=$(this).attr("rel");sp.loadSubPage("","training","singleModule")});$(".training_module").delegate("a.confirm",clickEvent,function(){var a=$(this).attr("rel");spModel.training.update("complete",{id:a},function(){sp.showSuccess("Finished");setTimeout(function(){$(".singleSection .backMenu").trigger(clickEvent)},2500)})});$(".training_module").delegate("a#tr_send_signature",clickEvent,function(){var a=$(this).attr("rel"),b=$("#digi_text").val();$(this).addClass("loading");
var c=$(this);spModel.training.update("complete",{id:a,signature:b},function(a){sp.showSuccess(a.data);"Signed"===a.data?setTimeout(function(){$(".singleSection .backMenu").trigger(clickEvent)},2500):c.removeClass("loading")})});$(".training_module").delegate("#show_all",clickEvent,function(){$(".training_module div[sign=sign]").show();$("#show_all").parent().remove()});$(".singleSection .backMenu").bind(clickEvent,function(a){a.preventDefault();a.stopPropagation();$(".subNavigation .training li.active a").trigger(clickEvent)});
$(".singleModule .backMenu").bind(clickEvent,function(a){a.preventDefault();a.stopPropagation();sp.loadSubPage("","training","singleSection")});$(".topicstatistic .backMenu").bind(clickEvent,function(a){a.preventDefault();a.stopPropagation();sp.loadSubPage("","training","singleModule")});$(".singleModule .subMenu .topic_stat").bind(clickEvent,function(a){a.preventDefault();a.stopPropagation();sp.loadSubPage("","training","topicstatistic")});$(".singleModule").delegate("#tr_send_comment",clickEvent,
function(a){a.preventDefault();a.stopPropagation();a=$.trim($("#tr_comment").val());0<a.length?($(this).addClass("loading"),spModel.training.update("comments",{module_id:sp.training.tmp_module,text:a,type:1},function(){sp.showSuccess("Comment added");setTimeout(function(){$(".singleModule .backMenu").trigger(clickEvent)},2500)})):sp.showError("Empty comment")})};
ShiftPlanningTraining.prototype.overviewSubEvents=function(){$(".subNavigation").show();$(".training").show();2>=sp.staff.admin.info.group&&$(".training  a[subpage=statistic]").parent().removeClass("hidden")};
ShiftPlanningTraining.prototype.sectionsSubEvents=function(){$(".subNavigation").show();$(".training").show();2>=sp.staff.admin.info.group&&($(".training  a[subpage=statistic]").parent().removeClass("hidden"),$(".training .singleModule .subMenu").removeClass("hidden"));$(".training_sections").html(spView.ulLoader());var a=[],b=[];spModel.training.get("progress",{},function(c){if("undefined"!=typeof c.data[sp.staff.admin.info.id]){var d=Math.round(100*(c.data[sp.staff.admin.info.id].completed/c.data[sp.staff.admin.info.id].total));
$("#user_progress").html(d);$(".progress").css("width",d+"%")}sp.training.statistic=c.data;spModel.training.get("sections",{},function(c){a=c.data;spModel.training.get("modules",{detailed:1},function(c){b=c.data;for(var c=[],d=0;d<a.length;d++){for(var e=[],i=a[d].notfinished_count=0;i<b.length;i++)a[d].id==b[i].section&&(2!=b[i].comment_type&&e.push(b[i]),"undefined"!=typeof b[i].employees&&"undefined"!=typeof b[i].employees[sp.staff.admin.info.id]&&(b[i].finished_flag=b[i].employees[sp.staff.admin.info.id].finished?
"1":"0","0"==b[i].finished_flag&&a[d].notfinished_count++,"undefined"!=typeof b[i].employees[sp.staff.admin.info.id].outdated&&(b[i].finished_flag="99",a[d].notfinished_count++)));a[d].modules=e;0<a[d].modules.length&&(c.push(a[d]),sp.training.trainings[a[d].id]=a[d])}$(".training_sections").html($.tmpl($("#te_tr_sections"),c));$(".training div.oneLine b").shorten();0==$(".training_sections > *").length&&$(".training_sections").html(spView.emptyResult(_s("No training topics."),"li"))})})})};
ShiftPlanningTraining.prototype.statisticSubEvents=function(){$(".subNavigation").show();$(".training").show();$(".training_statistic").html(spView.divLoader());if(2<sp.staff.admin.info.group)return sp.showError("You have no permission"),setTimeout(function(){sp.loadSubPage("","training","sections")},1500),!1;setTimeout(function(){var a=[];$.each(sp.training.statistic,function(){this.stat=0==this.completed?0:Math.round(100*(this.completed/this.total));this.avatar=sp.getAvatar(this.id);a.push(this)});
$(".training_statistic").html($.tmpl($("#te_tr_statistic"),a))},500)};
ShiftPlanningTraining.prototype.singleSectionSubEvents=function(){$(".training_singleSection").html(spView.ulLoader());$("#section_name").html(sp.training.trainings[sp.training.tmp_section].title);setTimeout(function(){for(var a=0;a<sp.training.trainings[sp.training.tmp_section].modules.length;a++)if("undefined"==typeof sp.training.trainings[sp.training.tmp_section].modules[a].finished_flag&&(sp.training.trainings[sp.training.tmp_section].modules[a].finished_flag=-99),0!=sp.training.trainings[sp.training.tmp_section].modules[a].duedate){var b=
new Date,c=new Date(1E3*sp.training.trainings[sp.training.tmp_section].modules[a].duedate),d=9<c.getMonth()?c.getMonth()+1:"0"+(c.getMonth()+1);sp.training.trainings[sp.training.tmp_section].modules[a].color=b>c?"#8C1919":"green";sp.training.trainings[sp.training.tmp_section].modules[a].duedate_formated=c.getDate()+"-"+d+"-"+c.getFullYear()}$(".training_singleSection").html($.tmpl($("#te_tr_singleSection"),sp.training.trainings[sp.training.tmp_section].modules));$(".training div.oneLine b").shorten()},
500)};
ShiftPlanningTraining.prototype.singleModuleSubEvents=function(){$(".training .training_module").html(spView.divLoader());setTimeout(function(){for(var a={},b=0;b<sp.training.trainings[sp.training.tmp_section].modules.length;b++)sp.training.tmp_module==sp.training.trainings[sp.training.tmp_section].modules[b].id&&(a=sp.training.trainings[sp.training.tmp_section].modules[b]);null!=a.contents?(a.contents=a.contents.replace(/\n/g,"</p><br/><p>"),a.contents=spView.bbc2HTML(a.contents)):a.contents="";
0<a.files.length&&$.each(a.files,function(){this.file_size=spView.friendly_filesize(this.file_size)});1==a.comment_type||1==a.digital_signature?(1==a.comment_type&&spModel.training.get("comments",{module_id:sp.training.tmp_module,type:1},function(b){var d=[];$.each(b.data,function(){sp.staff.admin.info.group<=a.can_see_comment&&(this.avatar=sp.getAvatar(this.user),d.push(this))});a.comments=d;1==a.digital_signature?spModel.training.get("digital_signature",{module_id:a.id},function(b){var c=[];$.each(b.data,
function(){2>=sp.staff.admin.info.group?(this.avatar=sp.getAvatar(this.user),c.push(this)):this.user==sp.staff.admin.info.id&&(this.avatar=sp.getAvatar(this.user),c.push(this))});a.signatures=c;$(".training_module").html($.tmpl($("#te_tr_module"),a));b=$(".training_module .wys");b.html(b.text());$.each(b.find("p"),function(){0==$(this).html().length&&$(this).remove()});$(".confirm").remove();$("div[sign=sign]:gt(5)").hide();$("<div>",{"class":"title1 wide"}).html($("<a>",{text:"show more",id:"show_all",
onclick:"void(0)"})).insertAfter($("div[sign=sign]:eq(5)"))}):($(".training_module").html($.tmpl($("#te_tr_module"),a)),b=$(".training_module .wys"),b.html(b.text()),$.each(b.find("p"),function(){0==$(this).html().length&&$(this).remove()}))}),1==a.digital_signature&&0==a.comment_type&&spModel.training.get("digital_signature",{module_id:a.id},function(b){var d=[];$.each(b.data,function(){2>=sp.staff.admin.info.group?(this.avatar=sp.getAvatar(this.user),d.push(this)):this.user==sp.staff.admin.info.id&&
(this.avatar=sp.getAvatar(this.user),d.push(this))});a.signatures=d;$(".training_module").html($.tmpl($("#te_tr_module"),a));b=$(".training_module .wys");b.html(b.text());$.each(b.find("p"),function(){0==$(this).html().length&&$(this).remove()});$(".confirm").remove();$("div[sign=sign]:gt(5)").hide();$("<div>",{"class":"title1 wide"}).html($("<a>",{text:"show more",id:"show_all",onclick:"void(0)"})).insertAfter($("div[sign=sign]:eq(5)"))})):($(".training_module").html($.tmpl($("#te_tr_module"),a)),
b=$(".training_module .wys"),b.html(b.text()),$.each(b.find("p"),function(){0==$(this).html().length&&$(this).remove()}))},500)};
ShiftPlanningTraining.prototype.topicstatisticSubEvents=function(){$(".training_topic_stat").html(spView.divLoader());if(2<sp.staff.admin.info.group)return sp.showError("You have no permission"),setTimeout(function(){sp.loadSubPage("","training","sections")},1500),!1;setTimeout(function(){for(var a={},b=0;b<sp.training.trainings[sp.training.tmp_section].modules.length;b++)sp.training.tmp_module==sp.training.trainings[sp.training.tmp_section].modules[b].id&&(a=sp.training.trainings[sp.training.tmp_section].modules[b]);
if("undefined"!=typeof a.employees&&null!=typeof a.employees){var c=[];$.each(a.employees,function(){this.avatar=sp.getAvatar(this.id);c.push(this)});$(".training_topic_stat").html($.tmpl($("#te_tr_topic_statistic"),c))}else $(".training_topic_stat").html("No employees on assigned on this topic")},500)};ShiftPlanningTraining.prototype.loadPage=function(){};ShiftPlanningSettings.prototype.initialize=function(){var a=this;$(document).ready(function(){a.overviewEvents()})};
ShiftPlanningSettings.prototype.loadSubPageEvents=function(a){if("recentShifts"==a||"upcomingShifts"==a)this.displayShifts(sp.staff.data.employees[$("#da_se_cur_us_id").val()],a);else this[a+"SubEvents"]()};ShiftPlanningSettings.prototype.loadPage=function(){};
ShiftPlanningSettings.prototype.overviewEvents=function(){var a=this;$("#da_se_ed_cu").delegate(".checkbox",clickEvent,function(){$(this).hasClass("check")?$(this).removeClass("check"):$(this).addClass("check")});$("#da_se_ed_po, #da_se_ov_po, #da_se_ed_sk, #da_se_ov_sk").delegate(".checkbox",clickEvent,function(){var b=$(this).attr("itemId"),c=0<$(this).parents(".skills").length?!0:!1,d=$(this).hasClass("check")?!0:!1,e=this;$(e).parent().addClass("loading");var f={id:$("#da_se_cur_us_id").val()};
c?d?f.removeskill=b:f.addskill=b:d?f.removeschedule=b:f.addschedule=b;spModel.staff.update("employee",f,function(b){d?$(e).removeClass("check"):$(e).addClass("check");$(e).parent().removeClass("loading");a.updateUser($("#da_se_cur_us_id").val(),b,!1)})});$("#da_se_ed_ue").bind(clickEvent,function(b){$(this).addClass("loading");b.preventDefault();a.saveEditForm($(this))});$("textarea#da_se_ov_no, textarea#da_se_ed_no").bind("blur",function(){a.updateNotes($(this).val())});$("#da_se_pa_up").bind(clickEvent,
function(b){b.preventDefault();a.changePassword()});$("#da_se_ov_aa a").bind(clickEvent,function(b){b.preventDefault();confirm(_s("Are you sure?"))&&a.adminActions(this)});$("#da_se_rs_li").delegate(".fr",clickEvent,function(a){a.preventDefault();switch($("#menu .mainNav .active").attr("id")){case "menu_staff":sp.schedule.fromStaff=!0;break;case "menu_dashboard":sp.schedule.fromStaff=!1}spModel.schedule.get("shift",{id:$(this).attr("shiftId"),detailed:1},function(a){sp.schedule.fromRecent=!0;sp.schedule.shift=
a.data;sp.loadSubPage("","schedule","shiftDisplay")})});$("#da_se_us_li").delegate(".fr",clickEvent,function(a){a.preventDefault();switch($("#menu .mainNav .active").attr("id")){case "menu_staff":sp.schedule.fromStaff=!0;break;case "menu_dashboard":sp.schedule.fromStaff=!1}spModel.schedule.get("shift",{id:$(this).attr("shiftId"),detailed:1},function(a){sp.schedule.fromUpcoming=!0;sp.schedule.shift=a.data;sp.loadSubPage("","schedule","shiftDisplay")})});$(".settings .backMenu").bind(clickEvent,function(a){a.preventDefault();
sp.hashChange=!1;sp.loadPage("staff");$(".subNavigation").show()});$("#settings .mainSub.settings .subNav").delegate("a",clickEvent,function(b){b.preventDefault();var b=$(this).attr("subpage"),c=$("#da_se_cur_us_id").val();"overview"==b?a.overviewSubEvents(sp.staff.data.employees[c]):a.loadSubPageEvents(b);$("#settings .mainSub.settings .subNav li").removeClass("active");$("#settings .mainSub.settings .subNav a[subpage="+b+"]").parent().addClass("active");$("#settings .main").hide();$("#settings .main."+
b).show();$("#settings .mainSub.settings").show();sp.fixCheckboxes()})};
ShiftPlanningSettings.prototype.overviewSubEvents=function(a){"undefined"==typeof a&&(a=sp.staff.admin.info);a.id==sp.staff.admin.info.id?($("#settings .search").show(),sp.permissions.hasPermission("edit_profile")?$("#settings .subNav a[subpage=edit]").show():$("#settings .subNav a[subpage=edit]").hide()):(4<sp.staff.admin.info.group?$("#settings .search").hide():($("#settings .subNav a[subpage=edit]").show(),$("#settings .search").show()),4<=sp.staff.admin.info.group&&$(".settings .subNav .hideEm").hide());
2>=a.group?$("#da_se_ov_aa .button").hide():$("#da_se_ov_aa .button").show();3<sp.staff.admin.info.group?$("#da_se_ov_wa").parent().hide():$("#da_se_ov_wa").parent().show();this.prefillOverview(a);this.prepareEditDetails(a);this.preparePasswordField(a);$("#settings .search.settings.mainSub ").hide();sp.fixCheckboxes()};ShiftPlanningSettings.prototype.editSubEvents=function(){};ShiftPlanningSettings.prototype.upcomingShiftsSubEvents=function(){};
ShiftPlanningSettings.prototype.recentShiftsSubEvents=function(){};ShiftPlanningSettings.prototype.passwordSubEvents=function(){};
ShiftPlanningSettings.prototype.prefillOverview=function(a){var b={};$.each(a,function(a,c){if(null==c||0==c.length)c="&nbsp;";b[a]=c});a=b;$("#da_se_cur_us_id").val(a.id);$("#da_se_ov_fn").html(a.name);$("#da_se_ov_id").html(a.eid);$("#da_se_ov_un").html(a.username);$("#da_se_ov_mo").html(a.cell_phone);$("#da_se_ov_ho").html(a.home_phone);$("#da_se_ov_em").html(a.email);0!=$.trim(a.wage).length&&$("#da_se_ov_wa").html(spView.fixCurrency(sp.staff.admin.settings.currency,!0)+a.wage);var c=_s("Administrative accounts cannot be de-activated."),
d=_s("User has actived his/her account.");1==parseInt(a.status)&&2<parseInt(a.group)?c=_s("User Account is Enabled."):0==parseInt(a.status)&&2<parseInt(a.group)&&(c=_s("User Account is Enabled."),d=_s("User account is not activated."));3<sp.staff.admin.info.group?($("#da_se_ov_aa").hide(),$("#da_se_ov_aa").prev().hide()):($("#da_se_ov_aa").prev().show(),$("#da_se_ov_aa").show());0==a.status?($("#da_se_ov_aa a[type=activate]").show(),$("#da_se_ov_aa a[type=manualyActivate]").show()):($("#da_se_ov_aa a[type=activate]").hide(),
$("#da_se_ov_aa a[type=manualyActivate]").hide());$("#da_se_ov_st").html(d);$("#da_se_ov_ac").html(c);0!=a.birth_month&&0!=a.birth_day?$("#da_se_ov_bd").html(months[a.birth_month-1]+" "+a.birth_day):$("#da_se_ov_bd").html("&nbsp;");$("#da_se_ov_cu").html(spView.customFields(a));$("#da_se_ov_po").html(spView.editableSchedules(a));$("#da_se_ov_sk").html(spView.editableSkills(a));$("#da_se_ov_no").html(0<a.notes.length?a.notes:"");$("#da_se_ov_pos").html("");if("undefined"!=typeof a.schedules){var e=
"";$.each(a.schedules,function(a,b){e+=b+", "});$("#da_se_ov_pos").html(e.substr(0,e.length-2))}};
ShiftPlanningSettings.prototype.prepareEditDetails=function(a){var b={};$.each(a,function(a,c){if(null==c||0==c.length)c="";b[a]=c});a=b;this.listLanguages();$("#da_se_ed_na").val(a.name);$("#da_se_ed_em").val(a.email);$("#da_se_ed_nn").val(a.nick_name);$("#da_se_ed_us").val(a.username);var c=null==a.cell_phone?["","","",""]:a.cell_phone.split("-");$("#da_se_ed_mph_0").val(c[0]);$("#da_se_ed_mph_1").val(c[1]);$("#da_se_ed_mph_2").val(c[2]);c=null==a.home_phone?["","","",""]:a.home_phone.split("-");
$("#da_se_ed_hph_0").val(c[0]);$("#da_se_ed_hph_1").val(c[1]);$("#da_se_ed_hph_2").val(c[2]);$("#da_se_ed_ad").val(a.address);$("#da_se_ed_ci").val(a.city);$("#da_se_ed_sp").val(a.state);$("#da_se_ed_pz").val(a.zip);$("#da_se_ed_bday_m").val(a.birth_month);$("#da_se_ed_bday_d").val(a.birth_day);$("#da_se_ed_no").val(a.notes);$("#da_se_ed_cu").html(spView.editableCustomFields(a));$("#da_se_ed_po").html(spView.editableSchedules(a));$("#da_se_ed_sk").html(spView.editableSkills(a));$("#da_se_ed_no").html(null!=
a.notes&&0<a.notes.length?a.notes:"");$("#da_se_ed_lang").val(a.language)};ShiftPlanningSettings.prototype.listLanguages=function(){var a='<option  value="none">'+_s("Company default")+"</option>";$.each(sp.raw.config.languages,function(b,c){a+='<option value="'+c.code+'">'+c.name+" "+(1==c.machine?"(machine)":"")+"</option>"});$("#da_se_ed_lang").html(a)};ShiftPlanningSettings.prototype.preparePasswordField=function(){$("#da_se_pa_np").val("");$("#da_se_pa_cp").val("")};
ShiftPlanningSettings.prototype.displayShifts=function(a,b){var c,d,e=!1;switch(b){case "recentShifts":$("#da_se_rs_li").html(spView.ulLoader());var f={start_date:"today -2 months",end_date:"yesterday",mode:"employee",employees:a.id},e=!0;c=$("#da_se_rs_li");d="No recent shifts";break;case "upcomingShifts":$("#da_se_us_li").html(spView.ulLoader()),f={start_date:"today ",end_date:"today +2 months",mode:"employee",employees:a.id},c=$("#da_se_us_li"),d="No upcoming shifts"}spModel.schedule.get("shifts",
f,function(a){if(""==a.data)$(c).html(spView.emptyResult(d));else if(e){e=!1;for(var b=[],f=a.data.length-1,h=0;h<a.data.length;h++)b.push(a.data[f--]);$(c).html($.tmpl($("#te_da_se_rs"),b))}else $(c).html($.tmpl($("#te_da_se_rs"),a.data))})};
ShiftPlanningSettings.prototype.updateUser=function(a,b,c){"undefined"==typeof c&&(c=!0);a==sp.staff.admin.info.id&&(sp.staff.admin.info=b.data);sp.staff.data.employees[""+a]=b.data;c&&this.overviewSubEvents(sp.staff.data.employees[""+a]);"staff"==sp.hash()&&$("#pages #settings .mainSub.settings").show();sp.showSuccess(_s("Selected user updated."))};
ShiftPlanningSettings.prototype.updateNotes=function(a){if(sp.hasPermission(4)||parseInt($("#da_se_cur_us_id").val())==sp.staff.admin.info.id){var b=this,c=$("#da_se_cur_us_id").val();spModel.staff.update("employee",{id:c,notes:a},function(a){b.updateUser(c,a)})}};
ShiftPlanningSettings.prototype.saveEditForm=function(a){var b=$("#da_se_cur_us_id").val(),c=this,d={},e=spModel.staff.getEmployeeById($("#da_se_cur_us_id").val());d.id=b;d.name=$("#da_se_ed_na").val();d.email=$("#da_se_ed_em").val();0<$("#da_se_ed_nn").val().length&&(d.nick_name=$("#da_se_ed_nn").val());3<$("#da_se_ed_us").val().length&&(d.username=$("#da_se_ed_us").val());0<$("#da_se_ed_ad").val().length&&(d.address=$("#da_se_ed_ad").val());0<$("#da_se_ed_ci").val().length&&(d.city=$("#da_se_ed_ci").val());
0<$("#da_se_ed_sp").val().length&&(d.state=$("#da_se_ed_sp").val());0<$("#da_se_ed_pz").val().length&&(d.zip=$("#da_se_ed_pz").val());d.language="none"==$("#da_se_ed_lang").val()?"":$("#da_se_ed_lang").val();d.birth_day=$("#da_se_ed_bday_d").val();d.birth_month=$("#da_se_ed_bday_m").val();0<$("#da_se_ed_mph_0").val().length&&(0<$("#da_se_ed_mph_1").val().length&&0<$("#da_se_ed_mph_2").val().length)&&(d.cell_phone=$("#da_se_ed_mph_0").val()+"-"+$("#da_se_ed_mph_1").val()+"-"+$("#da_se_ed_mph_2").val());
0<$("#da_se_ed_hph_0").val().length&&(0<$("#da_se_ed_hph_1").val().length&&0<$("#da_se_ed_hph_2").val().length)&&(d.home_phone=$("#da_se_ed_hph_0").val()+"-"+$("#da_se_ed_hph_1").val()+"-"+$("#da_se_ed_hph_2").val());var f={},g="";$('#da_se_ed_cu li [item="edit"]').each(function(a,b){g=$(b).val();0==g.lenght&&(g="");$(b).hasClass("checkbox check")?g=1:$(b).hasClass("checkbox")&&(g=0);f[$(b).attr("id")]=g});f=JSON.stringify(f);d.custom=f;spModel.staff.update("employee",d,function(d){e.id==sp.staff.admin.info.id&&
e.language!=d.data.language&&(setCookie("shiftplanning_mobile_lang",d.data.language,cookieExpire),window.location.reload());a.removeClass("loading");c.updateUser(b,d)},function(){a.removeClass("loading")})};ShiftPlanningSettings.prototype.changePassword=function(){var a=this,b=$("#da_se_cur_us_id").val();6<=$("#da_se_pa_np").val().length&&$("#da_se_pa_np").val()==$("#da_se_pa_cp").val()?spModel.staff.update("employee",{id:b,password:$("#da_se_pa_np").val()},function(c){a.updateUser(b,c)}):sp.showError(_s("Password length must 6 or more chars and passwords must match."))};
ShiftPlanningSettings.prototype.adminActions=function(a){var b=$("#da_se_cur_us_id").val(),c=$(a).attr("type"),d="update",b={id:b};"deactivate"==c?b.status=-1:"delete"==c?d="delete":"activate"==c?b.send_activation=1:b.status=1;sp.api("staff.employee",d,b,function(){sp.staff.getStaff(function(){"deactivate"==c?(sp.showSuccess(_s("User deactivated!")),$(".search.settings.mainSub .backMenu").trigger(clickEvent)):"delete"==c?(sp.showSuccess(_s("User deleted!")),$(".search.settings.mainSub .backMenu").trigger(clickEvent)):
"activate"==c?(sp.showSuccess(_s("Activation successfully sent.")),$(a).hide()):(sp.showSuccess(_s("Employee activated successfully.")),$("#da_se_ov_aa a[type=activate]").hide(),$(a).hide(),$("#da_se_ov_st").html(_s("User Account is Enabled.")))})},function(a){sp.showError(a.error)})};var cal,lastTouch,clickEvent="click",deviceAgent=navigator.userAgent.toLowerCase(),agentID=deviceAgent.match(/(iphone|ipod|ipad)/),ua=navigator.userAgent.toLowerCase(),isAndroid=-1<ua.indexOf("android");
agentID&&(clickEvent="click");
jQuery.event.special.touch={setup:function(){var a=jQuery(this);window.Touch?(a.bind("touchstart",jQuery.event.special.touch.onTouchStart),a.bind("touchmove",jQuery.event.special.touch.onTouchMove),a.bind("touchend",jQuery.event.special.touch.onTouchEnd)):a.bind("click",jQuery.event.special.touch.click)},click:function(a){a.type="touch";jQuery.event.handle.apply(this,arguments)},teardown:function(){var a=jQuery(this);window.Touch?(a.unbind("touchstart",jQuery.event.special.touch.onTouchStart),a.unbind("touchmove",
jQuery.event.special.touch.onTouchMove),a.unbind("touchend",jQuery.event.special.touch.onTouchEnd)):a.unbind("click",jQuery.event.special.touch.click)},onTouchStart:function(a){this.moved=!1;lastTouch=a.originalEvent.targetTouches[0]},onTouchMove:function(){this.moved=!0},onTouchEnd:function(a){this.moved||(a.type="touch",jQuery.event.handle.apply(this,arguments))}};
ShiftPlanning.prototype.toggleMenu=function(){$("#menu").toggleClass("hidden");$("#wrapper").toggleClass("extended");$("#wrapper").hasClass("extended")?($("#wrapper").css("margin-left",190),$("#menu").css("margin-left",0),$(".blackMask").css("display","block"),$(".blackMask").css("opacity","0.5")):($("#wrapper").css("margin-left",0),$("#menu").css("margin-left",-190),$(".blackMask").css("display","none"),$(".blackMask").css("opacity","0"))};
ShiftPlanning.prototype.loadSubPage=function(a,b,c){if("logout"==c)return this.staff.logout(),!1;$(".subNavigation").show();""==$.trim(c)&&(c=$(".subNav[page="+b+"] li:first a").attr("subpage"));"staff"==b&&"details"==c&&(c="list");""!=a&&(a.parent().parent().find("li").removeClass("active"),a.parent().addClass("active"));$(".subNavigation > div").hide();$(".subNavigation > div."+b).show();$("#pages > div").hide();$("#pages #"+b+" .main").hide();$("#pages #"+b+" .mainSub").hide();$("#pages #"+b).show();
$("#pages #"+b+" .main."+c).show();$("#pages #"+b+" .mainSub."+c).show();$("#menu .mainNav > li").removeClass("active");$("#menu_"+b).addClass("active");0<$(".subNav[page="+b+"] li a[subpage="+c+"]").length&&($(".subNav[page="+b+"] li").removeClass("active"),$(".subNav[page="+b+"] li a[subpage="+c+"]").parent().addClass("active"),sp.hash(b+"/"+c));"undefined"!=typeof this[b]&&"loadSubPageEvents"in this[b]&&this[b].loadSubPageEvents(c);sp.fixCheckboxes();"schedule"==b&&"addShift"==c||$(window).scrollTop(0)};
ShiftPlanning.prototype.initialize=function(){var a=this;$(window).hashchange(function(){if(!1==sp.hashChange)return sp.hashChange=!0,!1;if(0<sp.hash().length){var b=sp.hash(),c=!1,d=sp.hash().search("/");0<=d&&(b=sp.hash().substring(0,d),c=sp.hash().substring(d+1));if("logout"==b)return a.staff.logout(),!1;0<$("#menu [page="+b+"]").length?($("#pages > div").hide(),setTimeout(function(){$("#menu [page="+b+"]").parent().parent().find("li").removeClass("active");$("#menu [page="+b+"]").parent().addClass("active");
c?a.loadSubPage("",b,c):a.loadPage(b)},50)):"login"!=b&&"logout"!=b?user.loggedIn?a.hash("dashboard"):a.hash("login"):("logout"==a.hash()&&user.loggedIn&&a.staff.logout(),"login"==a.hash()&&user.loggedIn&&a.hash("dashboard"))}});$(document).ready(function(){init();$(".toggleMenu").bind(clickEvent,function(b){b.stopPropagation();b.preventDefault();a.toggleMenu()});user.loggedIn?($(".loginContainer").hide(),$("body").removeClass("login"),$("html").css("height","auto"),$(".applicationContainer").show(),
(0==sp.hash().length||"login"==sp.hash())&&sp.hash("dashboard")):($(".loginContainer").show(),$("body").addClass("login"),sp.hash("login"),$("#lo_u").focus());$("#wrapper .subNavigation .subNav:not(.notMain) a").bind(clickEvent,function(b){b.preventDefault();a.loadSubPage($(this),$(this).parent().parent().attr("page"),$(this).attr("subpage"))});$("#menu .mainNav > li > a").bind(clickEvent,function(b){if($(this).hasClass("exit"))return!0;b.preventDefault();var b=sp.hash(),c=sp.hash().search("/");0<=
c&&(b=sp.hash().substring(0,c));if($(this).attr("page")==b)return a.toggleMenu(),!1;$("#wrapper").hasClass("extended")&&a.toggleMenu();sp.hashChange=!0;b=$(this).attr("page");c=$(".subNav[page="+b+"] li:first a").attr("subpage");sp.hash(b+"/"+c)});$(window).hashchange();setInterval(function(){$("#menu").css("height",a.calculateMenuHeight());var b=a.calculateMenuHeight();$("#wrapper").css("min-height",b>a.calculateWrapperHeight()?b:a.calculateWrapperHeight());"0"==$(".blackMask").css("opacity")&&$(".blackMask").hide()},
1E3);$("#wrapper").width($(window).width());$("body").width($(window).width());$(".userName").bind(clickEvent,function(){sp.loadSubPage("","settings","overview")});isAndroid&&$("#da_up_fi_hide").hide()});$(window).bind("resize",function(){$("#wrapper").width($(window).width());$("body").width($(window).width())})};ShiftPlanning.prototype.calculateWrapperHeight=function(){var a=$("#pages").height()+$(".subNavigation").height()+20;return $(window).height()>a?$(window).height():a};
ShiftPlanning.prototype.calculateMenuHeight=function(){var a=this.calculateWrapperHeight();return $("#menu .mainNav").height()+150>a?$("#menu .mainNav").height()+150:a};ShiftPlanning.prototype.globalLoader=function(){};ShiftPlanning.prototype.fixCheckboxes=function(){$("#pages .checkbox:visible").removeClass("failsafe");$("#pages .checkbox:visible").each(function(){45<$(this).outerHeight(!0)&&$(this).addClass("failsafe")})};
ShiftPlanning.prototype.showSuccess=function(a){$("body").append('<div class="notification success hidden">'+a+"</div>");$("body > .notification").css("top",$(document).scrollTop());$("body > .notification").fadeIn("fast",function(){setTimeout(function(){$("body > .notification").fadeOut("fast",function(){$("body > .notification").remove()})},2E3)})};
ShiftPlanning.prototype.showError=function(a){$("body").append('<div class="notification error hidden">'+a+"</div>");$("body > .notification").css("top",$(document).scrollTop());$("body > .notification").fadeIn("fast",function(){setTimeout(function(){$("body > .notification").fadeOut("fast",function(){$("body > .notification").remove()})},2E3)})};
function callAndroid(a,b){return"undefined"!=typeof Android?("undefined"!=typeof a&&(a="showToast"),Android[a](function(a){if("undefined"!=typeof b)b(a);else return a})):!1}var sp=new ShiftPlanning;ShiftPlanning.prototype.staff=new ShiftPlanningStaff;ShiftPlanning.prototype.schedule=new ShiftPlanningSchedule;ShiftPlanning.prototype.dashboard=new ShiftPlanningDashboard;ShiftPlanning.prototype.timeClock=new ShiftPlanningTimeClock;ShiftPlanning.prototype.reports=new ShiftPlanningReports;
ShiftPlanning.prototype.requests=new ShiftPlanningRequests;ShiftPlanning.prototype.location=new ShiftPlanningLocation;ShiftPlanning.prototype.permissions=new ShiftPlanningPermissions;ShiftPlanning.prototype.training=new ShiftPlanningTraining;ShiftPlanning.prototype.settings=new ShiftPlanningSettings;
